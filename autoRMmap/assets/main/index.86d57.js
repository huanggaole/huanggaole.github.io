window.__require=function t(i,e,a){function h(o,l){if(!e[o]){if(!i[o]){var r=o.split("/");if(r=r[r.length-1],!i[r]){var n="function"==typeof __require&&__require;if(!l&&n)return n(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+o+"'")}o=r}var d=e[o]={exports:{}};i[o][0].call(d.exports,function(t){return h(i[o][1][t]||t)},d,d.exports,t,i,e,a)}return e[o].exports}for(var s="function"==typeof __require&&__require,o=0;o<a.length;o++)h(a[o]);return h}({LoadingScript:[function(t,i,e){"use strict";cc._RF.push(i,"bd9edQsI95N8IM9CGEUw/Tk","LoadingScript");var a,h=this&&this.__extends||(a=function(t,i){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,i)},function(t,i){function e(){this.constructor=t}a(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}),s=this&&this.__decorate||function(t,i,e,a){var h,s=arguments.length,o=s<3?i:null===a?a=Object.getOwnPropertyDescriptor(i,e):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,i,e,a);else for(var l=t.length-1;l>=0;l--)(h=t[l])&&(o=(s<3?h(o):s>3?h(i,e,o):h(i,e))||o);return s>3&&o&&Object.defineProperty(i,e,o),o};Object.defineProperty(e,"__esModule",{value:!0});var o=t("./tileManager"),l=cc._decorator,r=l.ccclass,n=l.property,d=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.processLabel=null,i.UI=null,i}return h(i,t),i.prototype.start=function(){},i.prototype.update=function(){var t=o.TileSet.finished/39;this.processLabel.string="Loading......\n\n\u52a0\u8f7d\u4e2d \u2026\u2026\n\n"+Math.floor(100*t)+"%",t>=1&&(this.UI.active=!1)},s([n(cc.Label)],i.prototype,"processLabel",void 0),s([n(cc.Node)],i.prototype,"UI",void 0),s([r],i)}(cc.Component);e.default=d,cc._RF.pop()},{"./tileManager":"tileManager"}],MIcaveScript:[function(t,i,e){"use strict";cc._RF.push(i,"ba759K9V7xBRJ8ety/ofwwf","MIcaveScript");var a,h=this&&this.__extends||(a=function(t,i){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,i)},function(t,i){function e(){this.constructor=t}a(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}),s=this&&this.__decorate||function(t,i,e,a){var h,s=arguments.length,o=s<3?i:null===a?a=Object.getOwnPropertyDescriptor(i,e):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,i,e,a);else for(var l=t.length-1;l>=0;l--)(h=t[l])&&(o=(s<3?h(o):s>3?h(i,e,o):h(i,e))||o);return s>3&&o&&Object.defineProperty(i,e,o),o};Object.defineProperty(e,"__esModule",{value:!0}),e.OperType=void 0;var o,l=t("./mainScript"),r=t("./saveFile"),n=t("./tileManager"),d=cc._decorator,c=d.ccclass,p=d.property;(function(t){t[t.Move=0]="Move",t[t.Pen=1]="Pen",t[t.PaintBucket=2]="PaintBucket"})(o=e.OperType||(e.OperType={}));var f=[0,1,1,1,0,-1,-1,-1],u=[-1,-1,0,1,1,1,0,-1],w=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.genBtn=null,i.widthText=null,i.heightText=null,i.typeToggle=null,i.operToggle=null,i.sketchToggle=null,i.mapSprite=null,i.createSketchNode=null,i.sketchNode=null,i.ornamentsSlider=null,i.ornamentsLabel=null,i.widthSlider=null,i.widthLabel=null,i.sdfBtn=null,i.generateBtn=null,i.clearBtn=null,i.saveBtn=null,i.width=10,i.height=10,i.ornamentsDensity=.3,i.widthDensity=.3,i.tilesetId=3,i.data1=[],i.data2=[],i.data3=[],i.data4=[],i.data5=[],i.data6=[],i.eightX=[-1,0,1,-1,1,-1,0,1],i.eightY=[-1,-1,-1,0,0,1,1,1],i.fourX=[-1,1,0,0],i.fourY=[0,0,-1,1],i.Base=1553,i.Base2=3296,i.Wall=6320,i.WallTop=5936,i.Stone1=[],i.prob1=[],i.Stone21=65,i.Stone22=73,i.WalkableStone=49,i.WalkableBase=1625,i.Hole=3392,i.Lake=2528,i.WallDecTop=[],i.probWallTop=[],i.WallDecDown=[],i.probWallDown=[],i.Wall21=[],i.Wall22=[],i.probWall2=[],i.widthmargin=3,i.heightmargin=3,i}var e;return h(i,t),e=i,i.prototype.start=function(){var t=this;this.createSketchNode.active=!0,this.sketchNode.active=!1;for(var i=function(t){a.typeToggle.node.children[t].on("click",function(){e.typeSeleceted=t},a)},a=this,h=0;h<this.typeToggle.node.children.length;h++)i(h);this.operToggle.node.children[0].on("click",function(){e.operType=o.Move},this),this.operToggle.node.children[1].on("click",function(){e.operType=o.Pen},this),this.operToggle.node.children[2].on("click",function(){e.operType=o.PaintBucket},this),this.sketchToggle.node.children[0].on("click",function(){e.sketchType=1},this),this.sketchToggle.node.children[1].on("click",function(){e.sketchType=0},this),this.sdfBtn.node.on("click",function(){t.makeSDF()},this),this.genBtn.node.on("click",function(){if(t.width=+t.widthText.string,t.height=+t.heightText.string,!t.width||t.width<=0||Number.isNaN(t.width))alert("\u8bf7\u8f93\u5165\u6709\u6548\u7684\u5730\u56fe\u5bbd\u5ea6\nPlease enter a valid map width");else if(!t.height||t.height<=0||Number.isNaN(t.height))alert("\u8bf7\u8f93\u5165\u6709\u6548\u7684\u5730\u56fe\u9ad8\u5ea6\nPlease enter a valid map height");else{var i=+new Date;t.generateSketch();var e=+new Date;console.log("\u603b\u7528\u65f6"+(e-i)+"ms")}},this),this.widthSlider.node.on("slide",function(){t.widthDensity=t.widthSlider.progress,t.widthLabel.string=Math.floor(100*t.widthDensity)+"%"},this),this.ornamentsSlider.node.on("slide",function(){t.ornamentsDensity=t.ornamentsSlider.progress,t.ornamentsLabel.string=Math.floor(100*t.ornamentsDensity)+"%"},this),this.generateBtn.node.on("click",function(){t.generateMap(),t.cleardeco(),t.adddeco(),t.DrawMap()},this),this.clearBtn.node.on("click",function(){t.cleardeco(),t.DrawMap()},this),this.saveBtn.node.on("click",function(){r.saveFile.instance.saveMap(r.saveFile.instance.tostring(t.tilesetId+1,t.width,t.height,t.data),"application/json","test")},this)},i.prototype.genstr=function(){for(var t=this.width,i=this.height,e="",a=0;a<=5;a++)for(var h=0;h<t*i;h++)0==a&&0==h||(e+=","),e+=this.data[a*t*i+h].toString();return e},i.prototype.generateSketch=function(){this.sdata=[],e.dataPath=[];for(var t=0;t<this.height;t++)for(var i=0;i<this.width;i++)this.sdata.push(0),e.dataPath.push(0);e.DrawSketch(this.width,this.height,this.mapSprite),this.createSketchNode.active=!1,this.sketchNode.active=!0},i.prototype.if_BP1_2to6=function(t,i,e){for(var a=0,h=0;h<8;h++)0!=t[(e+u[h])*this.width+(i+f[h])]&&a++;return a>=2&&a<=6},i.prototype.if_8B_changedOnce=function(t,i,e){for(var a=0,h=0;h<8;h++)0===t[(e+u[h])*this.width+(i+f[h])]&&1===t[(e+u[(h+1)%8])*this.width+(i+f[(h+1)%8])]&&a++;return 1===a},i.prototype.ifMultZero=function(t,i,e,a){for(var h=0;h<a.length;h++){var s=f[a[h]];if(0===t[(e+u[a[h]])*this.width+(i+s)])return!0}return!1},i.prototype.makeSDF=function(){for(var t=[],i=0;i<e.dataPath.length;i++)1!==e.dataPath[i]?(e.dataPath[i]=0,t.push(1)):t.push(0);for(;;){var a=[];for(i=0;i<t.length;i++)a.push(t[i]);for(var h=1;h<this.height-1;h++)for(i=1;i<this.width-1;i++)0!==t[o=h*this.width+i]&&this.if_BP1_2to6(a,i,h)&&this.if_8B_changedOnce(a,i,h)&&this.ifMultZero(a,i,h,[0,2,4])&&this.ifMultZero(a,i,h,[2,4,6])&&(t[o]=0);var s=!1;for(i=0;i<t.length;i++)t[i]!=a[i]&&(s=!0),a[i]=t[i];for(h=1;h<this.height-1;h++)for(i=1;i<this.width-1;i++){var o;0!==t[o=h*this.width+i]&&this.if_BP1_2to6(a,i,h)&&this.if_8B_changedOnce(a,i,h)&&this.ifMultZero(a,i,h,[0,2,6])&&this.ifMultZero(a,i,h,[0,4,6])&&(t[o]=0)}for(s=!1,i=0;i<t.length;i++)t[i]!=a[i]&&(s=!0),a[i]=t[i];if(!s)break}for(i=0;i<t.length;i++)1===t[i]&&(e.dataPath[i]=-1);for(;;){for(s=!1,i=0;i<e.dataPath.length;i++)if(e.dataPath[i]>0){var l=e.dataPath[i],r=Math.floor(i/this.width),n=i%this.width,d=l*this.widthDensity*.9;n>0&&Math.round(1e3*e.dataPath[i-1])<Math.round(1e3*d)&&e.dataPath[i-1]>=0&&(e.dataPath[i-1]=d,s=!0),n<this.width-1&&Math.round(1e3*e.dataPath[i+1])<Math.round(1e3*d)&&e.dataPath[i+1]>=0&&(e.dataPath[i+1]=d,s=!0),r>0&&Math.round(1e3*e.dataPath[i-this.width])<Math.round(1e3*d)&&e.dataPath[i-this.width]>=0&&(e.dataPath[i-this.width]=d,s=!0),r<this.height-1&&Math.round(1e3*e.dataPath[i+this.width])<Math.round(1e3*d)&&e.dataPath[i+this.width]>=0&&(e.dataPath[i+this.width]=d,s=!0)}if(!s)break}e.DrawSketch(this.width,this.height,this.mapSprite)},i.prototype.generateMap=function(){this.makeSDF(),this.data1=[],this.data2=[],this.data3=[],this.data4=[],this.data5=[],this.data6=[];for(var t=0;t<this.height;t++)for(var i=0;i<this.width;i++)this.data1.push(0),this.data2.push(0),this.data3.push(0),this.data4.push(0),this.data5.push(0),this.data6.push(0);this.initTilesType(),this.width<=25&&this.height<=25?this.initSmallRandomMap():(this.initRandomMap(),this.autoCell()),this.generateLakeandHole(),this.generateWall(),this.fillWallTops(),this.generateBase2(),this.updateAutoTiles(),this.data=this.data1.concat(this.data2.concat(this.data3.concat(this.data4.concat(this.data5.concat(this.data6))))),this.DrawMap(),this.saveBtn.node.active=!0},i.DrawSketch=function(t,i,a){var h=new cc.RenderTexture;this.newCanvas||(this.newCanvas=document.createElement("canvas")),this.newCanvas.width=t,this.newCanvas.height=i;var s=this.newCanvas.getContext("2d");s.beginPath(),s.fillStyle="#fff",s.fillRect(0,0,this.newCanvas.width,this.newCanvas.height);for(var o=0;o<e.dataPath.length;o++){var l=Math.floor(o/t),r=o%t;e.dataPath[o]&&(e.dataPath[o]<=1&&(s.fillStyle="#dd0"),e.dataPath[o]<=.99&&(s.fillStyle="#cc0"),e.dataPath[o]<=.89&&(s.fillStyle="#bb0"),e.dataPath[o]<=.79&&(s.fillStyle="#aa0"),e.dataPath[o]<=.69&&(s.fillStyle="#990"),e.dataPath[o]<=.59&&(s.fillStyle="#880"),e.dataPath[o]<=.49&&(s.fillStyle="#770"),e.dataPath[o]<=.39&&(s.fillStyle="#660"),e.dataPath[o]<=.29&&(s.fillStyle="#550"),e.dataPath[o]<=.1&&(s.fillStyle="#440"),e.dataPath[o]<-.1&&(s.fillStyle="#f00"),s.fillRect(r,l,1,1))}console.log(e.dataPath),h.initWithElement(this.newCanvas);var n=new cc.SpriteFrame(h);a.spriteFrame=n},i.prototype.DrawMap=function(){var t=new cc.RenderTexture,i=document.createElement("canvas");i.width=48*this.width,i.height=48*this.height;for(var e=i.getContext("2d"),a=0;a<this.data.length;a++){var h=Math.floor(a/(this.width*this.height)),s=a%(this.width*this.height),o=Math.floor(s/this.width),l=s%this.width,r=this.data[a];if(h<4&&r>0&&r<8192){var d=48*l,c=48*o,p=n.default.tileSets[this.tilesetId].tiletextures[r].img,f=n.default.tileSets[this.tilesetId].tiletextures[r].locUL,u=n.default.tileSets[this.tilesetId].tiletextures[r].locUR,w=n.default.tileSets[this.tilesetId].tiletextures[r].locDL,g=n.default.tileSets[this.tilesetId].tiletextures[r].locDR;e.drawImage(p,f.x,f.y,24,24,d,c,24,24),e.drawImage(p,u.x,u.y,24,24,d+24,c,24,24),e.drawImage(p,w.x,w.y,24,24,d,c+24,24,24),e.drawImage(p,g.x,g.y,24,24,d+24,c+24,24,24)}}t.initWithElement(i);var y=new cc.SpriteFrame(t);this.mapSprite.spriteFrame=y,this.createSketchNode.active=!1,this.sketchNode.active=!0},i.prototype.fillFlood=function(t,i,e,a,h){var s=[],o=new cc.Vec2(e,a);s.push(o),h[a*this.width+e]=i;for(var l=0;l<s.length;){var r=s[l];l++;for(var n=0;n<4;n++){var d=new cc.Vec2(r.x+this.fourX[n],r.y+this.fourY[n]);this.data1[d.y*this.width+d.x]===t&&h[d.y*this.width+d.x]!=i&&(h[d.y*this.width+d.x]=i,s.push(d))}}return s},i.prototype.initTilesType=function(){0===e.typeSeleceted?(this.Base=2816,this.Base2=2912,this.Wall=6272,this.WallTop=5888,l.default.editorType==l.EditorType.RMMV?(this.Stone1=[56,108,9,242],this.Stone21=64,this.Stone22=72,this.WalkableStone=48,this.WallDecTop=[144,0],this.Wall21=[153,0],this.Wall22=[161,0]):(this.Stone1=[40,124,199,242],this.Stone21=48,this.Stone22=56,this.WalkableStone=32,this.WallDecTop=[176,0],this.Wall21=[185,0],this.Wall22=[193,0]),this.WalkableBase=1624,this.Hole=3008,this.Lake=2432,this.prob1=[0,.4,.8,.9],this.probWall2=[0,.1],this.probWallTop=[0,.1],this.WallDecDown=[0],this.probWallDown=[0]):1===e.typeSeleceted?(this.Base=3200,this.Base2=3296,this.Wall=6320,this.WallTop=5936,l.default.editorType==l.EditorType.RMMV?(this.Stone1=[57,104,167,242],this.Stone21=65,this.Stone22=73,this.WalkableStone=49,this.WallDecTop=[155,144,165,0],this.Wall21=[152,153,154,0],this.Wall22=[160,161,162,0],this.WallDecDown=[163,167,0]):(this.Stone1=[41,120,190,242],this.Stone21=49,this.Stone22=57,this.WalkableStone=33,this.WallDecTop=[187,176,196,0],this.Wall21=[184,185,186,0],this.Wall22=[192,193,194,0],this.WallDecDown=[1,190,0]),this.prob1=[0,.4,.8,.9],this.WalkableBase=1625,this.Hole=3392,this.Lake=2528,this.probWall2=[0,.1,.2,.3],this.probWallTop=[0,.1,.2,.4],this.probWallDown=[0,.1,.3]):2===e.typeSeleceted?(this.Base=3584,this.Base2=3680,this.Wall=6368,this.WallTop=5984,l.default.editorType==l.EditorType.RMMV?(this.Stone1=[58,242],this.Stone21=66,this.Stone22=74,this.WalkableStone=50,this.Wall21=[156,0],this.Wall22=[164,0]):(this.Stone1=[42,242],this.Stone21=50,this.Stone22=58,this.WalkableStone=34,this.Wall21=[187,0],this.Wall22=[195,0]),this.prob1=[0,.9],this.WalkableBase=1626,this.Hole=3776,this.Lake=2240,this.probWall2=[0,.1],this.WallDecTop=[0],this.probWallTop=[0],this.WallDecDown=[0],this.probWallDown=[0]):3===e.typeSeleceted?(this.Base=3968,this.Base2=4064,this.Wall=6416,this.WallTop=6032,l.default.editorType==l.EditorType.RMMV?(this.Stone1=[59,106],this.Stone21=67,this.Stone22=75,this.WalkableStone=51,this.WallDecTop=[166,0],this.WallDecDown=[158,0],this.Wall21=[157,0],this.Wall22=[165,0]):(this.Stone1=[43,122],this.Stone21=51,this.Stone22=59,this.WalkableStone=35,this.WallDecTop=[197,0],this.WallDecDown=[189,0],this.Wall21=[188,0],this.Wall22=[196,0]),this.prob1=[0,.9],this.WalkableBase=1627,this.Hole=3440,this.Lake=3440,this.probWall2=[0,.1],this.probWallTop=[0,.1],this.probWallDown=[0,.1]):4===e.typeSeleceted?(this.Base=2864,this.Base2=2960,this.Wall=6464,this.WallTop=6080,l.default.editorType==l.EditorType.RMMV?(this.Stone1=[1,9,60,105,48,242],this.Stone21=68,this.Stone22=76,this.Wall21=[152,154],this.Wall22=[160,162],this.WallDecTop=[155,144],this.WallDecDown=[163,155],this.WalkableStone=52):(this.Stone1=[191,199,44,121,32,242],this.Stone21=52,this.Stone22=60,this.Wall21=[184,186],this.Wall22=[192,194],this.WallDecTop=[9,176],this.WallDecDown=[1,9],this.WalkableStone=36),this.prob1=[0,.2,.4,.6,.8,.9],this.WalkableBase=1628,this.Hole=3056,this.Lake=2336,this.probWall2=[0,.5],this.probWallTop=[0,.9],this.probWallDown=[0,.7]):5===e.typeSeleceted?(this.Base=3248,this.Base2=3344,this.Wall=6512,this.WallTop=6128,l.default.editorType==l.EditorType.RMMV?(this.Stone1=[61],this.Stone21=69,this.Stone22=77,this.WalkableStone=53):(this.Stone1=[45],this.Stone21=53,this.Stone22=61,this.WalkableStone=37),this.prob1=[0],this.WalkableBase=1629,this.Hole=4160,this.Lake=2624,this.Wall21=[0],this.Wall22=[0],this.probWall2=[0],this.WallDecTop=[0],this.probWallTop=[0],this.WallDecDown=[0],this.probWallDown=[0]):6===e.typeSeleceted?(this.Base=3632,this.Base2=3632,this.Wall=6560,this.WallTop=6176,l.default.editorType==l.EditorType.RMMV?(this.Stone1=[62],this.Stone21=70,this.Stone22=78,this.WalkableStone=54):(this.Stone1=[46],this.Stone21=54,this.Stone22=62,this.WalkableStone=38),this.prob1=[0],this.WalkableBase=1630,this.Hole=3824,this.Lake=3824,this.Wall21=[0],this.Wall22=[0],this.probWall2=[0],this.WallDecTop=[0],this.probWallTop=[0],this.WallDecDown=[0],this.probWallDown=[0]):7===e.typeSeleceted&&(this.Base=4016,this.Base2=4016,this.Wall=6608,this.WallTop=6224,l.default.editorType==l.EditorType.RMMV?(this.Stone1=[63,62,61],this.Stone21=71,this.Stone22=79,this.WalkableStone=55,this.Wall21=[153,0],this.Wall22=[161,0],this.WallDecTop=[144,0]):(this.Stone1=[47,46,45],this.Stone21=55,this.Stone22=63,this.WalkableStone=39,this.Wall21=[185,0],this.Wall22=[193,0],this.WallDecTop=[176,0]),this.prob1=[0,.4,.7],this.WalkableBase=1631,this.Hole=4208,this.Lake=4208,this.probWall2=[0,.2],this.probWallTop=[0,.1],this.WallDecDown=[0],this.probWallDown=[0])},i.prototype.initSmallRandomMap=function(){if(!(this.width<2*this.widthmargin+1||this.height<2*this.heightmargin+1))for(var t=0;t<e.dataPath.length;t++)e.dataPath[t]>.9&&(this.data1[t]=this.Base)},i.prototype.initRandomMap=function(){this.widthmargin=3,this.heightmargin=3;for(var t=0;t<this.height;t++)for(var i=0;i<this.width;i++)i>this.widthmargin&&i<this.width-this.widthmargin&&t>this.heightmargin&&t<this.height-this.heightmargin&&(this.data1[t*this.width+i]=Math.random()<e.dataPath[t*this.width+i]?this.Base:0)},i.prototype.autoCell=function(){for(var t=100,i=new Array(this.data1.length),a=0;a<this.data1.length;a++)i[a]=this.data1[a];for(;t>0;){for(t--,a=this.heightmargin;a<this.height-this.heightmargin;a++)for(var h=this.widthmargin;h<this.width-this.widthmargin;h++){for(var s=0,o=a-1;o<=a+1;o++)for(var l=h-1;l<=h+1;l++)o==a&&l==h||i[o*this.width+l]==this.Base&&s++;s>4?this.data1[a*this.width+h]=this.Base:s<4&&(this.data1[a*this.width+h]=0)}for(a=0;a<e.dataPath.length;a++)e.dataPath[a]>=.9?this.data1[a]=this.Base:e.dataPath[a]<=0&&(this.data1[a]=0);for(a=0;a<this.data1.length;a++)i[a]=this.data1[a]}},i.prototype.connectAllBase=function(){for(var t=new Array(this.height*this.width),i=[],e=0;e<this.height;e++)for(var a=0;a<this.width;a++)t[e*this.width+a]=-1;var h=0;for(e=0;e<this.height;e++)for(a=0;a<this.width;a++)if(this.data1[e*this.width+a]===this.Base&&-1===t[e*this.width+a]){var s=this.fillFlood(this.Base,h,a,e,t);i.push(s),h++}if(1!==i.length){var o=0,l=0;for(e=0;e<i.length;e++)i[e].length>l&&(o=e,l=i[e].length);for(e=0;e<i.length;e++)if(e!==o){var r=[];for(a=0;a<10;a++){var n=[],d=i[e][Math.floor(Math.random()*i[e].length)];n.push(d),r.push(n)}for(var c=-1;;){for(a=0;a<10;a++){var p=r[a][r[a].length-1],f=Math.floor(4*Math.random()),u=new cc.Vec2(p.x+this.fourX[f],p.y+this.fourY[f]);if(u.x>=this.widthmargin&&u.x<this.width-this.widthmargin&&u.y>=this.heightmargin&&u.y<this.height-this.heightmargin&&(r[a].push(u),t[u.y*this.width+u.x]===o)){c=a;break}}if(c>=0){for(a=0;a<r[c].length;a++)p=r[c][a],this.data1[p.y*this.width+p.x]=this.Base,t[p.y*this.width+p.x]=o;for(a=0;a<i[e].length;a++)t[(p=i[e][a]).y*this.width+p.x]=o;break}}}}},i.prototype.generateLakeandHole=function(){for(var t=new Array(this.height*this.width),i=[],e=0;e<this.height;e++)for(var a=0;a<this.width;a++)t[e*this.width+a]=-1;var h=0;for(e=0;e<this.height;e++)for(a=0;a<this.width;a++)if(0===this.data1[e*this.width+a]&&-1===t[e*this.width+a]){var s=this.fillFlood(0,h,a,e,t);i.push(s),h++}for(e=1;e<i.length;e++)if(Math.random()<.5)if(Math.random()<.5)for(a=0;a<i[e].length;a++)this.data1[i[e][a].y*this.width+i[e][a].x]=this.Hole;else for(a=0;a<i[e].length;a++)this.data1[i[e][a].y*this.width+i[e][a].x]=this.Lake},i.prototype.generateWall=function(){for(var t=this.height-2;t>2;t--)for(var i=this.width-2;i>2;i--)this.data1[t*this.width+i]===this.Base&&0===this.data1[(t-1)*this.width+i]&&this.data1[(t-2)*this.width+i]===this.Base&&(this.data1[(t-1)*this.width+i]=this.Lake),this.data1[t*this.width+i]===this.Base&&0===this.data1[(t-1)*this.width+i]&&0===this.data1[(t-2)*this.width+i]&&this.data1[(t-3)*this.width+i]===this.Base&&(this.data1[(t-1)*this.width+i]=this.Lake,this.data1[(t-2)*this.width+i]=this.Lake);for(t=this.height-2;t>=2;t--)for(i=this.width-1;i>0;i--)this.data1[t*this.width+i]===this.Base&&0===this.data1[(t-1)*this.width+i]&&0===this.data1[(t-2)*this.width+i]&&(this.data1[(t-1)*this.width+i]=this.Wall,t-3>=0&&0===this.data1[(t-3)*this.width+i]&&(this.data1[(t-2)*this.width+i]=this.Wall));for(t=1;t<this.height-1;t++)for(i=1;i<this.width-1;i++)if(0===this.data1[t*this.width+i])for(var e=0;e<8;e++){var a=this.data1[(t+this.eightY[e])*this.width+i+this.eightX[e]];a!==this.Wall&&a!==this.Base||(this.data1[t*this.width+i]=this.WallTop)}},i.prototype.fillWallTops=function(){for(var t=0;t<this.height;t++)for(var i=0;i<this.width;i++)0===this.data1[t*this.width+i]&&(this.data1[t*this.width+i]=this.WallTop)},i.prototype.generateBase2=function(){if(this.Base2!==this.Base)for(var t=Math.floor(Math.random()*Math.sqrt(this.width+this.height)),i=0;i<t;i++){var e=1+Math.floor(Math.random()*this.width-2),a=1+Math.floor(Math.random()*this.height-2);if(this.data1[a*this.width+e]===this.Base){var h=Math.floor(5*Math.random()),s=Math.floor(5*Math.random()),o=Math.floor(5*Math.random()),l=Math.floor(5*Math.random());this.renderBase2(e,a,h,o,l,s)}else i--}},i.prototype.renderBase2=function(t,i,e,a,h,s){var o=0;if(this.data1[i*this.width+t]===this.Base||this.data1[i*this.width+t]===this.Base2){for(var l=0;l<8;l++){var r=t+this.eightX[l],n=i+this.eightY[l];this.data1[n*this.width+r]!==this.Base&&this.data1[n*this.width+r]!==this.Base2||o++}if(o>=7){this.data1[i*this.width+t]=this.Base2;for(var d=0;d<4;d++)0==d&&e>0&&this.renderBase2(t+this.fourX[d],i+this.fourY[d],e-1,e-1,e-1,e-1),1==d&&a>0&&this.renderBase2(t+this.fourX[d],i+this.fourY[d],a-1,a-1,a-1,a-1),2==d&&h>0&&this.renderBase2(t+this.fourX[d],i+this.fourY[d],h-1,h-1,h-1,h-1),3==d&&s>0&&this.renderBase2(t+this.fourX[d],i+this.fourY[d],s-1,s-1,s-1,s-1)}}},i.prototype.updateAutoTiles=function(){for(var t=new Array(this.data1.length),i=0;i<this.data1.length;i++)t[i]=this.data1[i];for(var e=!0;e;)for(e=!1,i=1;i<this.height-1;i++)for(var a=1;a<this.width-1;a++){var h=this.data1[(i-1)*this.width+a-1],s=this.data1[(i-1)*this.width+a],o=this.data1[(i-1)*this.width+a+1],l=this.data1[i*this.width+a-1],r=this.data1[i*this.width+a+1],n=this.data1[(i+1)*this.width+a-1],d=this.data1[(i+1)*this.width+a],c=this.data1[(i+1)*this.width+a+1],p=this.data1[i*this.width+a];t[i*this.width+a]===this.Wall&&(this.data1[i*this.width+a]=this.updateWall(t[i*this.width+a],h,s,o,l,r,n,d,c),p!==this.data1[i*this.width+a]&&(e=!0)),t[i*this.width+a]===this.Base2&&this.Base2!==this.Base&&(this.data1[i*this.width+a]=this.updateFloor(t[i*this.width+a],h,s,o,l,r,n,d,c),p!==this.data1[i*this.width+a]&&(e=!0)),t[i*this.width+a]===this.WallTop&&(this.data1[i*this.width+a]=this.updateFloor(t[i*this.width+a],h,s,o,l,r,n,d,c),p!==this.data1[i*this.width+a]&&(e=!0)),t[i*this.width+a]===this.Hole&&(this.data1[i*this.width+a]=this.updateFloor(t[i*this.width+a],h,s,o,l,r,n,d,c),p!==this.data1[i*this.width+a]&&(e=!0)),t[i*this.width+a]===this.Lake&&(this.data1[i*this.width+a]=this.updateFloor(t[i*this.width+a],h,s,o,l,r,n,d,c),p!==this.data1[i*this.width+a]&&(e=!0))}},i.prototype.updateWall=function(t,i,e,a,h,s,o,l){var r=!0,n=!0,d=!0,c=!0;e<t||e>t+15?r=!1:(e%2==1&&(d=!1),Math.floor(e/4)%2==1&&(c=!1)),l<t||l>t+15?n=!1:(l%2==1&&(d=!1),Math.floor(l/4)%2==1&&(c=!1)),(h<t||h>t+15)&&(d=!1),(s<t||s>t+15)&&(c=!1);var p=t;return!1===d&&(p+=1),!1===c&&(p+=4),!1===r&&(p+=2),!1===n&&(p+=8),p},i.prototype.updateFloor=function(t,i,e,a,h,s,o,l,r){var n=!0,d=!0,c=!0,p=!0,f=!0,u=!0,w=!0,g=!0;(i<t||i>t+48)&&(n=!1),(e<t||e>t+48)&&(d=!1),(a<t||a>t+48)&&(c=!1),(h<t||h>t+48)&&(w=!1),(s<t||s>t+48)&&(g=!1),(o<t||o>t+48)&&(p=!1),(l<t||l>t+48)&&(f=!1),(r<t||r>t+48)&&(u=!1);var y=t;return c=!c,w=!w,g=!g,p=!p,f=!f,u=!u,(d=!d)||w||g||f||(y+=0),!(n=!n)||d||c||w||g||p||f||u||(y+=1),n||d||!c||w||g||p||f||u||(y+=2),!n||d||!c||w||g||p||f||u||(y+=3),n||d||c||w||g||p||f||!u||(y+=4),!n||d||c||w||g||p||f||!u||(y+=5),n||d||!c||w||g||p||f||!u||(y+=6),!n||d||!c||w||g||p||f||!u||(y+=7),n||d||c||w||g||!p||f||u||(y+=8),!n||d||c||w||g||!p||f||u||(y+=9),n||d||!c||w||g||!p||f||u||(y+=10),!n||d||!c||w||g||!p||f||u||(y+=11),n||d||c||w||g||!p||f||!u||(y+=12),!n||d||c||w||g||!p||f||!u||(y+=13),n||d||!c||w||g||!p||f||!u||(y+=14),n&&!d&&c&&!w&&!g&&p&&!f&&u&&(y+=15),d||c||!w||g||f||u||(y+=16),d||!c||!w||g||f||u||(y+=17),d||c||!w||g||f||!u||(y+=18),!d&&c&&w&&!g&&!f&&u&&(y+=19),!d||w||g||p||f||u||(y+=20),!d||w||g||p||f||!u||(y+=21),!d||w||g||!p||f||u||(y+=22),d&&!w&&!g&&p&&!f&&u&&(y+=23),n||d||w||!g||p||f||(y+=24),n||d||w||!g||!p||f||(y+=25),!n||d||w||!g||p||f||(y+=26),n&&!d&&!w&&g&&p&&!f&&(y+=27),n||d||c||w||g||!f||(y+=28),!n||d||c||w||g||!f||(y+=29),n||d||!c||w||g||!f||(y+=30),n&&!d&&c&&!w&&!g&&f&&(y+=31),!d&&w&&g&&!f&&(y+=32),d&&!w&&!g&&f&&(y+=33),!d||!w||g||f||u||(y+=34),d&&w&&!g&&!f&&u&&(y+=35),!d||w||!g||p||f||(y+=36),d&&!w&&g&&p&&!f&&(y+=37),n||d||w||!g||!f||(y+=38),n&&!d&&!w&&g&&f&&(y+=39),d||c||!w||g||!f||(y+=40),!d&&c&&w&&!g&&f&&(y+=41),d&&w&&g&&!f&&(y+=42),d&&w&&!g&&f&&(y+=43),!d&&w&&g&&f&&(y+=44),d&&!w&&g&&f&&(y+=45),d&&w&&g&&f&&(y+=46),y},i.prototype.ifWallTileType=function(t,i){return t>=i&&t<i+16},i.prototype.ifcanBarr=function(t,i,e,a,h,s,o,l){var r=new Array(9);r[0]=t,r[1]=i,r[2]=e,r[3]=a,r[4]=!1,r[5]=h,r[6]=s,r[7]=o,r[8]=l;for(var n=0,d=0;d<9;d++)!0===r[d]&&(n=d);var c=[];c.push(n);for(var p=0;p<c.length;){var f=c[p];p++,r[f]=!1;for(var u=f%3,w=Math.floor(f/3),g=0;g<4;g++){var y=u+this.fourX[g],v=w+this.fourY[g];y>=0&&y<3&&v>=0&&v<3&&!0===r[3*v+y]&&c.push(3*v+y)}}for(d=0;d<9;d++)if(!0===r[d])return!1;return!0},i.prototype.walkable=function(t,i){if(this.data1[i*this.width+t]!==this.Base&&this.data1[i*this.width+t]!==this.Base2&&this.data1[i*this.width+t]!==this.WalkableBase)return!1;if(this.data3[i*this.width+t]===this.Stone22)return!1;for(var e=0;e<this.Stone1.length;e++)if(this.data3[i*this.width+t]===this.Stone1[e])return!1;return!0},i.prototype.cleardeco=function(){for(var t=0;t<this.height;t++)for(var i=0;i<this.width;i++)this.data3[t*this.width+i]=0,this.data4[t*this.width+i]=0,this.data1[t*this.width+i]===this.WalkableBase&&(this.data1[t*this.width+i]=this.Base);this.data=this.data1.concat(this.data2.concat(this.data3.concat(this.data4.concat(this.data5.concat(this.data6)))))},i.prototype.adddeco=function(){for(var t=[],i=[],e=1;e<this.height-1;e++)for(var a=1;a<this.width;a++)this.ifWallTileType(this.data1[e*this.width+a],this.Wall)&&!this.ifWallTileType(this.data1[(e-1)*this.width+a],this.Wall)&&t.push(new cc.Vec2(a,e)),this.ifWallTileType(this.data1[e*this.width+a],this.Wall)&&!this.ifWallTileType(this.data1[(e+1)*this.width+a],this.Wall)&&i.push(new cc.Vec2(a,e));var h=t.length*this.ornamentsDensity;for(e=0;e<h/3;e++){var s=Math.random(),o=void 0;for(a=0;a<this.probWallTop.length;a++)s>this.probWallTop[a]&&(o=a);var l=t[Math.floor(Math.random()*t.length)];0===this.data3[l.y*this.width+l.x]&&(this.data3[l.y*this.width+l.x]=this.WallDecTop[o])}for(e=0;e<h/3;e++){for(s=Math.random(),o=void 0,a=0;a<this.probWallDown.length;a++)s>this.probWallDown[a]&&(o=a);l=i[Math.floor(Math.random()*i.length)],0===this.data3[l.y*this.width+l.x]&&(this.data3[l.y*this.width+l.x]=this.WallDecDown[o])}for(e=0;e<h/3;e++){for(s=Math.random(),o=void 0,a=0;a<this.probWall2.length;a++)s>this.probWall2[a]&&(o=a);l=t[Math.floor(Math.random()*t.length)],0===this.data3[l.y*this.width+l.x]&&0===this.data3[(l.x,l.y+1)]&&(this.data3[l.y*this.width+l.x]=this.Wall21[o],this.data3[(l.y+1)*this.width+l.x]=this.Wall22[o])}for(h=this.width*this.height*this.ornamentsDensity,e=0;e<h/4;e++){var r=1+Math.floor(Math.random()*(this.width-2)),n=1+Math.floor(Math.random()*(this.height-2));this.data1[n*this.width+r]===this.Base&&(this.data1[n*this.width+r]=this.WalkableBase)}for(e=0;e<h/4;e++)if(r=1+Math.floor(Math.random()*(this.width-2)),n=1+Math.floor(Math.random()*(this.height-2)),this.walkable(r,n)){var d=this.walkable(r-1,n-1),c=this.walkable(r,n-1),p=this.walkable(r+1,n-1),f=this.walkable(r-1,n),u=this.walkable(r+1,n),w=this.walkable(r-1,n+1),g=this.walkable(r,n+1),y=this.walkable(r+1,n+1);if(this.ifcanBarr(d,c,p,f,u,w,g,y)){s=Math.random();for(var v=0,W=0;W<this.prob1.length&&s>this.prob1[W];W++)v=W;this.data3[n*this.width+r]=this.Stone1[v]}}for(e=0;e<h/4;e++)r=1+Math.floor(Math.random()*(this.width-2)),n=1+Math.floor(Math.random()*(this.height-2)),this.walkable(r,n)&&(d=this.walkable(r-1,n-1),c=this.walkable(r,n-1),p=this.walkable(r+1,n-1),f=this.walkable(r-1,n),u=this.walkable(r+1,n),w=this.walkable(r-1,n+1),g=this.walkable(r,n+1),y=this.walkable(r+1,n+1),this.ifcanBarr(d,c,p,f,u,w,g,y)&&(this.data4[(n-1)*this.width+r]=this.Stone21,this.data3[n*this.width+r]=this.Stone22));for(e=0;e<h/4;e++)r=1+Math.floor(Math.random()*(this.width-2)),n=1+Math.floor(Math.random()*(this.height-2)),this.walkable(r,n)&&(this.data3[n*this.width+r]=this.WalkableStone);this.data=this.data1.concat(this.data2.concat(this.data3.concat(this.data4.concat(this.data5.concat(this.data6)))))},i.typeSeleceted=0,i.operType=o.Move,i.sketchType=1,i.dataPath=[],i.ornamentsdensity=.3,s([p(cc.Button)],i.prototype,"genBtn",void 0),s([p(cc.EditBox)],i.prototype,"widthText",void 0),s([p(cc.EditBox)],i.prototype,"heightText",void 0),s([p(cc.ToggleGroup)],i.prototype,"typeToggle",void 0),s([p(cc.ToggleGroup)],i.prototype,"operToggle",void 0),s([p(cc.ToggleGroup)],i.prototype,"sketchToggle",void 0),s([p(cc.Sprite)],i.prototype,"mapSprite",void 0),s([p(cc.Node)],i.prototype,"createSketchNode",void 0),s([p(cc.Node)],i.prototype,"sketchNode",void 0),s([p(cc.Slider)],i.prototype,"ornamentsSlider",void 0),s([p(cc.Label)],i.prototype,"ornamentsLabel",void 0),s([p(cc.Slider)],i.prototype,"widthSlider",void 0),s([p(cc.Label)],i.prototype,"widthLabel",void 0),s([p(cc.Button)],i.prototype,"sdfBtn",void 0),s([p(cc.Button)],i.prototype,"generateBtn",void 0),s([p(cc.Button)],i.prototype,"clearBtn",void 0),s([p(cc.Button)],i.prototype,"saveBtn",void 0),e=s([c],i)}(cc.Component);e.default=w,cc._RF.pop()},{"./mainScript":"mainScript","./saveFile":"saveFile","./tileManager":"tileManager"}],caveScript:[function(t,i,e){"use strict";cc._RF.push(i,"a3e1b6B1OpGOqx4Sq52rCiA","caveScript");var a,h=this&&this.__extends||(a=function(t,i){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,i)},function(t,i){function e(){this.constructor=t}a(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}),s=this&&this.__decorate||function(t,i,e,a){var h,s=arguments.length,o=s<3?i:null===a?a=Object.getOwnPropertyDescriptor(i,e):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,i,e,a);else for(var l=t.length-1;l>=0;l--)(h=t[l])&&(o=(s<3?h(o):s>3?h(i,e,o):h(i,e))||o);return s>3&&o&&Object.defineProperty(i,e,o),o};Object.defineProperty(e,"__esModule",{value:!0});var o=t("./mainScript"),l=t("./saveFile"),r=t("./tileManager"),n=cc._decorator,d=n.ccclass,c=n.property,p=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.genBtn=null,i.widthText=null,i.heightText=null,i.typeToggle=null,i.mapSprite=null,i.ornamentsNode=null,i.ornamentsSlider=null,i.densityLabel=null,i.ornamentsBtn=null,i.clearBtn=null,i.saveBtn=null,i.width=10,i.height=10,i.ornamentsdensity=.3,i.tilesetId=3,i.data1=[],i.data2=[],i.data3=[],i.data4=[],i.data5=[],i.data6=[],i.eightX=[-1,0,1,-1,1,-1,0,1],i.eightY=[-1,-1,-1,0,0,1,1,1],i.fourX=[-1,1,0,0],i.fourY=[0,0,-1,1],i.Base=1553,i.Base2=3296,i.Wall=6320,i.WallTop=5936,i.Stone1=[],i.prob1=[],i.Stone21=65,i.Stone22=73,i.WalkableStone=49,i.WalkableBase=1625,i.Hole=3392,i.Lake=2528,i.WallDecTop=[],i.probWallTop=[],i.WallDecDown=[],i.probWallDown=[],i.Wall21=[],i.Wall22=[],i.probWall2=[],i.widthmargin=3,i.heightmargin=3,i}var e;return h(i,t),e=i,i.prototype.start=function(){for(var t=this,i=function(t){a.typeToggle.node.children[t].on("click",function(){e.typeSeleceted=t},a)},a=this,h=0;h<this.typeToggle.node.children.length;h++)i(h);this.genBtn.node.on("click",function(){if(t.width=+t.widthText.string,t.height=+t.heightText.string,!t.width||t.width<=0||NaN===t.width)alert("\u8bf7\u8f93\u5165\u6709\u6548\u7684\u5730\u56fe\u5bbd\u5ea6\nPlease enter a valid map width");else if(!t.height||t.height<=0||NaN===t.height)alert("\u8bf7\u8f93\u5165\u6709\u6548\u7684\u5730\u56fe\u9ad8\u5ea6\nPlease enter a valid map height");else{var i=+new Date;t.generateMap();var e=+new Date;console.log("\u603b\u7528\u65f6"+(e-i)+"ms")}},this),this.ornamentsSlider.node.on("slide",function(){t.ornamentsdensity=t.ornamentsSlider.progress,t.densityLabel.string=Math.floor(100*t.ornamentsdensity)+"%"},this),this.ornamentsBtn.node.on("click",function(){t.cleardeco(),t.adddeco(),t.DrawMap(),t.ornamentsBtn.getComponentInChildren(cc.Label).string="Refresh Ornaments(\u91cd\u65b0\u88c5\u9970)"},this),this.clearBtn.node.on("click",function(){t.cleardeco(),t.DrawMap()},this),this.saveBtn.node.on("click",function(){l.saveFile.instance.saveMap(l.saveFile.instance.tostring(t.tilesetId+1,t.width,t.height,t.data),"application/json","test")},this)},i.prototype.genstr=function(){for(var t=this.width,i=this.height,e="",a=0;a<=5;a++)for(var h=0;h<t*i;h++)0==a&&0==h||(e+=","),e+=this.data[a*t*i+h].toString();return e},i.prototype.generateMap=function(){this.data1=[],this.data2=[],this.data3=[],this.data4=[],this.data5=[],this.data6=[];for(var t=0;t<this.height;t++)for(var i=0;i<this.width;i++)this.data1.push(0),this.data2.push(0),this.data3.push(0),this.data4.push(0),this.data5.push(0),this.data6.push(0);this.initTilesType(),this.width<=25&&this.height<=25?this.initSmallRandomMap():(this.initRandomMap(),this.autoCell()),this.connectAllBase(),this.generateLakeandHole(),this.generateWall(),this.fillWallTops(),this.generateBase2(),this.updateAutoTiles(),this.data=this.data1.concat(this.data2.concat(this.data3.concat(this.data4.concat(this.data5.concat(this.data6))))),this.DrawMap()},i.prototype.DrawMap=function(){var t=new cc.RenderTexture,i=document.createElement("canvas");i.width=48*this.width,i.height=48*this.height;for(var e=i.getContext("2d"),a=0;a<this.data.length;a++){var h=Math.floor(a/(this.width*this.height)),s=a%(this.width*this.height),o=Math.floor(s/this.width),l=s%this.width,n=this.data[a];if(h<4&&n>0&&n<8192){var d=48*l,c=48*o,p=r.default.tileSets[this.tilesetId].tiletextures[n].img,f=r.default.tileSets[this.tilesetId].tiletextures[n].locUL,u=r.default.tileSets[this.tilesetId].tiletextures[n].locUR,w=r.default.tileSets[this.tilesetId].tiletextures[n].locDL,g=r.default.tileSets[this.tilesetId].tiletextures[n].locDR;e.drawImage(p,f.x,f.y,24,24,d,c,24,24),e.drawImage(p,u.x,u.y,24,24,d+24,c,24,24),e.drawImage(p,w.x,w.y,24,24,d,c+24,24,24),e.drawImage(p,g.x,g.y,24,24,d+24,c+24,24,24)}}t.initWithElement(i);var y=new cc.SpriteFrame(t);this.mapSprite.spriteFrame=y,this.ornamentsNode.active=!0},i.prototype.fillFlood=function(t,i,e,a,h){var s=[],o=new cc.Vec2(e,a);s.push(o),h[a*this.width+e]=i;for(var l=0;l<s.length;){var r=s[l];l++;for(var n=0;n<4;n++){var d=new cc.Vec2(r.x+this.fourX[n],r.y+this.fourY[n]);this.data1[d.y*this.width+d.x]===t&&h[d.y*this.width+d.x]!=i&&(h[d.y*this.width+d.x]=i,s.push(d))}}return s},i.prototype.initTilesType=function(){0===e.typeSeleceted?(this.Base=2816,this.Base2=2912,this.Wall=6272,this.WallTop=5888,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[56,108,9,242],this.Stone21=64,this.Stone22=72,this.WalkableStone=48,this.WallDecTop=[144,0],this.Wall21=[153,0],this.Wall22=[161,0]):(this.Stone1=[40,124,199,242],this.Stone21=48,this.Stone22=56,this.WalkableStone=32,this.WallDecTop=[176,0],this.Wall21=[185,0],this.Wall22=[193,0]),this.WalkableBase=1624,this.Hole=3008,this.Lake=2432,this.prob1=[0,.4,.8,.9],this.probWall2=[0,.1],this.probWallTop=[0,.1],this.WallDecDown=[0],this.probWallDown=[0]):1===e.typeSeleceted?(this.Base=3200,this.Base2=3296,this.Wall=6320,this.WallTop=5936,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[57,104,167,242],this.Stone21=65,this.Stone22=73,this.WalkableStone=49,this.WallDecTop=[155,144,165,0],this.Wall21=[152,153,154,0],this.Wall22=[160,161,162,0],this.WallDecDown=[163,167,0]):(this.Stone1=[41,120,190,242],this.Stone21=49,this.Stone22=57,this.WalkableStone=33,this.WallDecTop=[187,176,196,0],this.Wall21=[184,185,186,0],this.Wall22=[192,193,194,0],this.WallDecDown=[1,190,0]),this.prob1=[0,.4,.8,.9],this.WalkableBase=1625,this.Hole=3392,this.Lake=2528,this.probWall2=[0,.1,.2,.3],this.probWallTop=[0,.1,.2,.4],this.probWallDown=[0,.1,.3]):2===e.typeSeleceted?(this.Base=3584,this.Base2=3680,this.Wall=6368,this.WallTop=5984,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[58,242],this.Stone21=66,this.Stone22=74,this.WalkableStone=50,this.Wall21=[156,0],this.Wall22=[164,0]):(this.Stone1=[42,242],this.Stone21=50,this.Stone22=58,this.WalkableStone=34,this.Wall21=[187,0],this.Wall22=[195,0]),this.prob1=[0,.9],this.WalkableBase=1626,this.Hole=3776,this.Lake=2240,this.probWall2=[0,.1],this.WallDecTop=[0],this.probWallTop=[0],this.WallDecDown=[0],this.probWallDown=[0]):3===e.typeSeleceted?(this.Base=3968,this.Base2=4064,this.Wall=6416,this.WallTop=6032,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[59,106],this.Stone21=67,this.Stone22=75,this.WalkableStone=51,this.WallDecTop=[166,0],this.WallDecDown=[158,0],this.Wall21=[157,0],this.Wall22=[165,0]):(this.Stone1=[43,122],this.Stone21=51,this.Stone22=59,this.WalkableStone=35,this.WallDecTop=[197,0],this.WallDecDown=[189,0],this.Wall21=[188,0],this.Wall22=[196,0]),this.prob1=[0,.9],this.WalkableBase=1627,this.Hole=3440,this.Lake=3440,this.probWall2=[0,.1],this.probWallTop=[0,.1],this.probWallDown=[0,.1]):4===e.typeSeleceted?(this.Base=2864,this.Base2=2960,this.Wall=6464,this.WallTop=6080,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[1,9,60,105,48,242],this.Stone21=68,this.Stone22=76,this.Wall21=[152,154],this.Wall22=[160,162],this.WallDecTop=[155,144],this.WallDecDown=[163,155],this.WalkableStone=52):(this.Stone1=[191,199,44,121,32,242],this.Stone21=52,this.Stone22=60,this.Wall21=[184,186],this.Wall22=[192,194],this.WallDecTop=[9,176],this.WallDecDown=[1,9],this.WalkableStone=36),this.prob1=[0,.2,.4,.6,.8,.9],this.WalkableBase=1628,this.Hole=3056,this.Lake=2336,this.probWall2=[0,.5],this.probWallTop=[0,.9],this.probWallDown=[0,.7]):5===e.typeSeleceted?(this.Base=3248,this.Base2=3344,this.Wall=6512,this.WallTop=6128,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[61],this.Stone21=69,this.Stone22=77,this.WalkableStone=53):(this.Stone1=[45],this.Stone21=53,this.Stone22=61,this.WalkableStone=37),this.prob1=[0],this.WalkableBase=1629,this.Hole=4160,this.Lake=2624,this.Wall21=[0],this.Wall22=[0],this.probWall2=[0],this.WallDecTop=[0],this.probWallTop=[0],this.WallDecDown=[0],this.probWallDown=[0]):6===e.typeSeleceted?(this.Base=3632,this.Base2=3632,this.Wall=6560,this.WallTop=6176,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[62],this.Stone21=70,this.Stone22=78,this.WalkableStone=54):(this.Stone1=[46],this.Stone21=54,this.Stone22=62,this.WalkableStone=38),this.prob1=[0],this.WalkableBase=1630,this.Hole=3824,this.Lake=3824,this.Wall21=[0],this.Wall22=[0],this.probWall2=[0],this.WallDecTop=[0],this.probWallTop=[0],this.WallDecDown=[0],this.probWallDown=[0]):7===e.typeSeleceted&&(this.Base=4016,this.Base2=4016,this.Wall=6608,this.WallTop=6224,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[63,62,61],this.Stone21=71,this.Stone22=79,this.WalkableStone=55,this.Wall21=[153,0],this.Wall22=[161,0],this.WallDecTop=[144,0]):(this.Stone1=[47,46,45],this.Stone21=55,this.Stone22=63,this.WalkableStone=39,this.Wall21=[185,0],this.Wall22=[193,0],this.WallDecTop=[176,0]),this.prob1=[0,.4,.7],this.WalkableBase=1631,this.Hole=4208,this.Lake=4208,this.probWall2=[0,.2],this.probWallTop=[0,.1],this.WallDecDown=[0],this.probWallDown=[0])},i.prototype.initSmallRandomMap=function(){if(!(this.width<2*this.widthmargin+1||this.height<2*this.heightmargin+1))for(var t=2+Math.floor(Math.random()*this.width*this.height/6),i=0;i<t;i++){var e=this.widthmargin+Math.floor(Math.random()*(this.width-2*this.widthmargin)),a=this.heightmargin+Math.floor(Math.random()*(this.height-2*this.heightmargin));this.data1[a*this.width+e]=this.Base}},i.prototype.initRandomMap=function(){this.widthmargin=3,this.heightmargin=3;for(var t=0;t<this.height;t++)for(var i=0;i<this.width;i++)i>this.widthmargin&&i<this.width-this.widthmargin&&t>this.heightmargin&&t<this.height-this.heightmargin&&(this.data1[t*this.width+i]=2*Math.random()<1?0:this.Base)},i.prototype.autoCell=function(){for(var t=100,i=new Array(this.data1.length),e=0;e<this.data1.length;e++)i[e]=this.data1[e];for(;t>0;){for(t--,e=this.heightmargin;e<this.height-this.heightmargin;e++)for(var a=this.widthmargin;a<this.width-this.widthmargin;a++){for(var h=0,s=e-1;s<=e+1;s++)for(var o=a-1;o<=a+1;o++)s==e&&o==a||i[s*this.width+o]==this.Base&&h++;h>4?this.data1[e*this.width+a]=this.Base:h<4&&(this.data1[e*this.width+a]=0)}for(e=0;e<this.data1.length;e++)i[e]=this.data1[e]}},i.prototype.connectAllBase=function(){for(var t=new Array(this.height*this.width),i=[],e=0;e<this.height;e++)for(var a=0;a<this.width;a++)t[e*this.width+a]=-1;var h=0;for(e=0;e<this.height;e++)for(a=0;a<this.width;a++)if(this.data1[e*this.width+a]===this.Base&&-1===t[e*this.width+a]){var s=this.fillFlood(this.Base,h,a,e,t);i.push(s),h++}if(1!==i.length){var o=0,l=0;for(e=0;e<i.length;e++)i[e].length>l&&(o=e,l=i[e].length);for(e=0;e<i.length;e++)if(e!==o){var r=[];for(a=0;a<10;a++){var n=[],d=i[e][Math.floor(Math.random()*i[e].length)];n.push(d),r.push(n)}for(var c=-1;;){for(a=0;a<10;a++){var p=r[a][r[a].length-1],f=Math.floor(4*Math.random()),u=new cc.Vec2(p.x+this.fourX[f],p.y+this.fourY[f]);if(u.x>=this.widthmargin&&u.x<this.width-this.widthmargin&&u.y>=this.heightmargin&&u.y<this.height-this.heightmargin&&(r[a].push(u),t[u.y*this.width+u.x]===o)){c=a;break}}if(c>=0){for(a=0;a<r[c].length;a++)p=r[c][a],this.data1[p.y*this.width+p.x]=this.Base,t[p.y*this.width+p.x]=o;for(a=0;a<i[e].length;a++)t[(p=i[e][a]).y*this.width+p.x]=o;break}}}}},i.prototype.generateLakeandHole=function(){for(var t=new Array(this.height*this.width),i=[],e=0;e<this.height;e++)for(var a=0;a<this.width;a++)t[e*this.width+a]=-1;var h=0;for(e=0;e<this.height;e++)for(a=0;a<this.width;a++)if(0===this.data1[e*this.width+a]&&-1===t[e*this.width+a]){var s=this.fillFlood(0,h,a,e,t);i.push(s),h++}for(e=1;e<i.length;e++)if(Math.random()<.5)if(Math.random()<.5)for(a=0;a<i[e].length;a++)this.data1[i[e][a].y*this.width+i[e][a].x]=this.Hole;else for(a=0;a<i[e].length;a++)this.data1[i[e][a].y*this.width+i[e][a].x]=this.Lake},i.prototype.generateWall=function(){for(var t=this.height-2;t>2;t--)for(var i=this.width-2;i>2;i--)this.data1[t*this.width+i]===this.Base&&0===this.data1[(t-1)*this.width+i]&&this.data1[(t-2)*this.width+i]===this.Base&&(this.data1[(t-1)*this.width+i]=this.Base),this.data1[t*this.width+i]===this.Base&&0===this.data1[(t-1)*this.width+i]&&0===this.data1[(t-2)*this.width+i]&&this.data1[(t-3)*this.width+i]===this.Base&&(this.data1[(t-1)*this.width+i]=this.Base,this.data1[(t-2)*this.width+i]=this.Base);for(t=this.height-2;t>=2;t--)for(i=this.width-1;i>0;i--)this.data1[t*this.width+i]===this.Base&&0===this.data1[(t-1)*this.width+i]&&0===this.data1[(t-2)*this.width+i]&&(this.data1[(t-1)*this.width+i]=this.Wall,t-3>=0&&0===this.data1[(t-3)*this.width+i]&&(this.data1[(t-2)*this.width+i]=this.Wall));for(t=1;t<this.height-1;t++)for(i=1;i<this.width-1;i++)if(0===this.data1[t*this.width+i])for(var e=0;e<8;e++){var a=this.data1[(t+this.eightY[e])*this.width+i+this.eightX[e]];a!==this.Wall&&a!==this.Base||(this.data1[t*this.width+i]=this.WallTop)}},i.prototype.fillWallTops=function(){for(var t=0;t<this.height;t++)for(var i=0;i<this.width;i++)0===this.data1[t*this.width+i]&&(this.data1[t*this.width+i]=this.WallTop)},i.prototype.generateBase2=function(){if(this.Base2!==this.Base)for(var t=Math.floor(Math.random()*Math.sqrt(this.width+this.height)),i=0;i<t;i++){var e=1+Math.floor(Math.random()*this.width-2),a=1+Math.floor(Math.random()*this.height-2);if(this.data1[a*this.width+e]===this.Base){var h=Math.floor(5*Math.random()),s=Math.floor(5*Math.random()),o=Math.floor(5*Math.random()),l=Math.floor(5*Math.random());this.renderBase2(e,a,h,o,l,s)}else i--}},i.prototype.renderBase2=function(t,i,e,a,h,s){var o=0;if(this.data1[i*this.width+t]===this.Base||this.data1[i*this.width+t]===this.Base2){for(var l=0;l<8;l++){var r=t+this.eightX[l],n=i+this.eightY[l];this.data1[n*this.width+r]!==this.Base&&this.data1[n*this.width+r]!==this.Base2||o++}if(o>=7){this.data1[i*this.width+t]=this.Base2;for(var d=0;d<4;d++)0==d&&e>0&&this.renderBase2(t+this.fourX[d],i+this.fourY[d],e-1,e-1,e-1,e-1),1==d&&a>0&&this.renderBase2(t+this.fourX[d],i+this.fourY[d],a-1,a-1,a-1,a-1),2==d&&h>0&&this.renderBase2(t+this.fourX[d],i+this.fourY[d],h-1,h-1,h-1,h-1),3==d&&s>0&&this.renderBase2(t+this.fourX[d],i+this.fourY[d],s-1,s-1,s-1,s-1)}}},i.prototype.updateAutoTiles=function(){for(var t=new Array(this.data1.length),i=0;i<this.data1.length;i++)t[i]=this.data1[i];for(var e=!0;e;)for(e=!1,i=1;i<this.height-1;i++)for(var a=1;a<this.width-1;a++){var h=this.data1[(i-1)*this.width+a-1],s=this.data1[(i-1)*this.width+a],o=this.data1[(i-1)*this.width+a+1],l=this.data1[i*this.width+a-1],r=this.data1[i*this.width+a+1],n=this.data1[(i+1)*this.width+a-1],d=this.data1[(i+1)*this.width+a],c=this.data1[(i+1)*this.width+a+1],p=this.data1[i*this.width+a];t[i*this.width+a]===this.Wall&&(this.data1[i*this.width+a]=this.updateWall(t[i*this.width+a],h,s,o,l,r,n,d,c),p!==this.data1[i*this.width+a]&&(e=!0)),t[i*this.width+a]===this.Base2&&this.Base2!==this.Base&&(this.data1[i*this.width+a]=this.updateFloor(t[i*this.width+a],h,s,o,l,r,n,d,c),p!==this.data1[i*this.width+a]&&(e=!0)),t[i*this.width+a]===this.WallTop&&(this.data1[i*this.width+a]=this.updateFloor(t[i*this.width+a],h,s,o,l,r,n,d,c),p!==this.data1[i*this.width+a]&&(e=!0)),t[i*this.width+a]===this.Hole&&(this.data1[i*this.width+a]=this.updateFloor(t[i*this.width+a],h,s,o,l,r,n,d,c),p!==this.data1[i*this.width+a]&&(e=!0)),t[i*this.width+a]===this.Lake&&(this.data1[i*this.width+a]=this.updateFloor(t[i*this.width+a],h,s,o,l,r,n,d,c),p!==this.data1[i*this.width+a]&&(e=!0))}},i.prototype.updateWall=function(t,i,e,a,h,s,o,l){var r=!0,n=!0,d=!0,c=!0;e<t||e>t+15?r=!1:(e%2==1&&(d=!1),Math.floor(e/4)%2==1&&(c=!1)),l<t||l>t+15?n=!1:(l%2==1&&(d=!1),Math.floor(l/4)%2==1&&(c=!1)),(h<t||h>t+15)&&(d=!1),(s<t||s>t+15)&&(c=!1);var p=t;return!1===d&&(p+=1),!1===c&&(p+=4),!1===r&&(p+=2),!1===n&&(p+=8),p},i.prototype.updateFloor=function(t,i,e,a,h,s,o,l,r){var n=!0,d=!0,c=!0,p=!0,f=!0,u=!0,w=!0,g=!0;(i<t||i>t+48)&&(n=!1),(e<t||e>t+48)&&(d=!1),(a<t||a>t+48)&&(c=!1),(h<t||h>t+48)&&(w=!1),(s<t||s>t+48)&&(g=!1),(o<t||o>t+48)&&(p=!1),(l<t||l>t+48)&&(f=!1),(r<t||r>t+48)&&(u=!1);var y=t;return c=!c,w=!w,g=!g,p=!p,f=!f,u=!u,(d=!d)||w||g||f||(y+=0),!(n=!n)||d||c||w||g||p||f||u||(y+=1),n||d||!c||w||g||p||f||u||(y+=2),!n||d||!c||w||g||p||f||u||(y+=3),n||d||c||w||g||p||f||!u||(y+=4),!n||d||c||w||g||p||f||!u||(y+=5),n||d||!c||w||g||p||f||!u||(y+=6),!n||d||!c||w||g||p||f||!u||(y+=7),n||d||c||w||g||!p||f||u||(y+=8),!n||d||c||w||g||!p||f||u||(y+=9),n||d||!c||w||g||!p||f||u||(y+=10),!n||d||!c||w||g||!p||f||u||(y+=11),n||d||c||w||g||!p||f||!u||(y+=12),!n||d||c||w||g||!p||f||!u||(y+=13),n||d||!c||w||g||!p||f||!u||(y+=14),n&&!d&&c&&!w&&!g&&p&&!f&&u&&(y+=15),d||c||!w||g||f||u||(y+=16),d||!c||!w||g||f||u||(y+=17),d||c||!w||g||f||!u||(y+=18),!d&&c&&w&&!g&&!f&&u&&(y+=19),!d||w||g||p||f||u||(y+=20),!d||w||g||p||f||!u||(y+=21),!d||w||g||!p||f||u||(y+=22),d&&!w&&!g&&p&&!f&&u&&(y+=23),n||d||w||!g||p||f||(y+=24),n||d||w||!g||!p||f||(y+=25),!n||d||w||!g||p||f||(y+=26),n&&!d&&!w&&g&&p&&!f&&(y+=27),n||d||c||w||g||!f||(y+=28),!n||d||c||w||g||!f||(y+=29),n||d||!c||w||g||!f||(y+=30),n&&!d&&c&&!w&&!g&&f&&(y+=31),!d&&w&&g&&!f&&(y+=32),d&&!w&&!g&&f&&(y+=33),!d||!w||g||f||u||(y+=34),d&&w&&!g&&!f&&u&&(y+=35),!d||w||!g||p||f||(y+=36),d&&!w&&g&&p&&!f&&(y+=37),n||d||w||!g||!f||(y+=38),n&&!d&&!w&&g&&f&&(y+=39),d||c||!w||g||!f||(y+=40),!d&&c&&w&&!g&&f&&(y+=41),d&&w&&g&&!f&&(y+=42),d&&w&&!g&&f&&(y+=43),!d&&w&&g&&f&&(y+=44),d&&!w&&g&&f&&(y+=45),d&&w&&g&&f&&(y+=46),y},i.prototype.ifWallTileType=function(t,i){return t>=i&&t<i+16},i.prototype.ifcanBarr=function(t,i,e,a,h,s,o,l){var r=new Array(9);r[0]=t,r[1]=i,r[2]=e,r[3]=a,r[4]=!1,r[5]=h,r[6]=s,r[7]=o,r[8]=l;for(var n=0,d=0;d<9;d++)!0===r[d]&&(n=d);var c=[];c.push(n);for(var p=0;p<c.length;){var f=c[p];p++,r[f]=!1;for(var u=f%3,w=Math.floor(f/3),g=0;g<4;g++){var y=u+this.fourX[g],v=w+this.fourY[g];y>=0&&y<3&&v>=0&&v<3&&!0===r[3*v+y]&&c.push(3*v+y)}}for(d=0;d<9;d++)if(!0===r[d])return!1;return!0},i.prototype.walkable=function(t,i){if(this.data1[i*this.width+t]!==this.Base&&this.data1[i*this.width+t]!==this.Base2&&this.data1[i*this.width+t]!==this.WalkableBase)return!1;if(this.data3[i*this.width+t]===this.Stone22)return!1;for(var e=0;e<this.Stone1.length;e++)if(this.data3[i*this.width+t]===this.Stone1[e])return!1;return!0},i.prototype.cleardeco=function(){for(var t=0;t<this.height;t++)for(var i=0;i<this.width;i++)this.data3[t*this.width+i]=0,this.data4[t*this.width+i]=0,this.data1[t*this.width+i]===this.WalkableBase&&(this.data1[t*this.width+i]=this.Base);this.data=this.data1.concat(this.data2.concat(this.data3.concat(this.data4.concat(this.data5.concat(this.data6)))))},i.prototype.adddeco=function(){for(var t=[],i=[],e=1;e<this.height-1;e++)for(var a=1;a<this.width;a++)this.ifWallTileType(this.data1[e*this.width+a],this.Wall)&&!this.ifWallTileType(this.data1[(e-1)*this.width+a],this.Wall)&&t.push(new cc.Vec2(a,e)),this.ifWallTileType(this.data1[e*this.width+a],this.Wall)&&!this.ifWallTileType(this.data1[(e+1)*this.width+a],this.Wall)&&i.push(new cc.Vec2(a,e));var h=t.length*this.ornamentsdensity;for(e=0;e<h/3;e++){var s=Math.random(),o=void 0;for(a=0;a<this.probWallTop.length;a++)s>this.probWallTop[a]&&(o=a);var l=t[Math.floor(Math.random()*t.length)];0===this.data3[l.y*this.width+l.x]&&(this.data3[l.y*this.width+l.x]=this.WallDecTop[o])}for(e=0;e<h/3;e++){for(s=Math.random(),o=void 0,a=0;a<this.probWallDown.length;a++)s>this.probWallDown[a]&&(o=a);l=i[Math.floor(Math.random()*i.length)],0===this.data3[l.y*this.width+l.x]&&(this.data3[l.y*this.width+l.x]=this.WallDecDown[o])}for(e=0;e<h/3;e++){for(s=Math.random(),o=void 0,a=0;a<this.probWall2.length;a++)s>this.probWall2[a]&&(o=a);l=t[Math.floor(Math.random()*t.length)],0===this.data3[l.y*this.width+l.x]&&0===this.data3[(l.x,l.y+1)]&&(this.data3[l.y*this.width+l.x]=this.Wall21[o],this.data3[(l.y+1)*this.width+l.x]=this.Wall22[o])}for(h=this.width*this.height*this.ornamentsdensity,e=0;e<h/4;e++){var r=1+Math.floor(Math.random()*(this.width-2)),n=1+Math.floor(Math.random()*(this.height-2));this.data1[n*this.width+r]===this.Base&&(this.data1[n*this.width+r]=this.WalkableBase)}for(e=0;e<h/4;e++)if(r=1+Math.floor(Math.random()*(this.width-2)),n=1+Math.floor(Math.random()*(this.height-2)),this.walkable(r,n)){var d=this.walkable(r-1,n-1),c=this.walkable(r,n-1),p=this.walkable(r+1,n-1),f=this.walkable(r-1,n),u=this.walkable(r+1,n),w=this.walkable(r-1,n+1),g=this.walkable(r,n+1),y=this.walkable(r+1,n+1);if(this.ifcanBarr(d,c,p,f,u,w,g,y)){s=Math.random();for(var v=0,W=0;W<this.prob1.length&&s>this.prob1[W];W++)v=W;this.data3[n*this.width+r]=this.Stone1[v]}}for(e=0;e<h/4;e++)r=1+Math.floor(Math.random()*(this.width-2)),n=1+Math.floor(Math.random()*(this.height-2)),this.walkable(r,n)&&(d=this.walkable(r-1,n-1),c=this.walkable(r,n-1),p=this.walkable(r+1,n-1),f=this.walkable(r-1,n),u=this.walkable(r+1,n),w=this.walkable(r-1,n+1),g=this.walkable(r,n+1),y=this.walkable(r+1,n+1),this.ifcanBarr(d,c,p,f,u,w,g,y)&&(this.data4[(n-1)*this.width+r]=this.Stone21,this.data3[n*this.width+r]=this.Stone22));for(e=0;e<h/4;e++)r=1+Math.floor(Math.random()*(this.width-2)),n=1+Math.floor(Math.random()*(this.height-2)),this.walkable(r,n)&&(this.data3[n*this.width+r]=this.WalkableStone);this.data=this.data1.concat(this.data2.concat(this.data3.concat(this.data4.concat(this.data5.concat(this.data6)))))},i.typeSeleceted=0,i.ornamentsdensity=.3,s([c(cc.Button)],i.prototype,"genBtn",void 0),s([c(cc.EditBox)],i.prototype,"widthText",void 0),s([c(cc.EditBox)],i.prototype,"heightText",void 0),s([c(cc.ToggleGroup)],i.prototype,"typeToggle",void 0),s([c(cc.Sprite)],i.prototype,"mapSprite",void 0),s([c(cc.Node)],i.prototype,"ornamentsNode",void 0),s([c(cc.Slider)],i.prototype,"ornamentsSlider",void 0),s([c(cc.Label)],i.prototype,"densityLabel",void 0),s([c(cc.Button)],i.prototype,"ornamentsBtn",void 0),s([c(cc.Button)],i.prototype,"clearBtn",void 0),s([c(cc.Button)],i.prototype,"saveBtn",void 0),e=s([d],i)}(cc.Component);e.default=p,cc._RF.pop()},{"./mainScript":"mainScript","./saveFile":"saveFile","./tileManager":"tileManager"}],mainScript:[function(t,i,e){"use strict";cc._RF.push(i,"d7c71y0hVtIuonI7Bgg4uwR","mainScript");var a,h=this&&this.__extends||(a=function(t,i){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,i)},function(t,i){function e(){this.constructor=t}a(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}),s=this&&this.__decorate||function(t,i,e,a){var h,s=arguments.length,o=s<3?i:null===a?a=Object.getOwnPropertyDescriptor(i,e):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,i,e,a);else for(var l=t.length-1;l>=0;l--)(h=t[l])&&(o=(s<3?h(o):s>3?h(i,e,o):h(i,e))||o);return s>3&&o&&Object.defineProperty(i,e,o),o};Object.defineProperty(e,"__esModule",{value:!0}),e.EditorType=void 0;var o,l=cc._decorator,r=l.ccclass,n=l.property;(function(t){t.RMMV="RMMV",t.RMMZ="RMMZ"})(o=e.EditorType||(e.EditorType={}));var d=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.rmmvBtn=null,i.rmmzBtn=null,i}var e;return h(i,t),e=i,i.prototype.start=function(){this.rmmvBtn.node.on("click",function(){e.editorType=o.RMMV,cc.director.loadScene("typeMenu")},this),this.rmmzBtn.node.on("click",function(){e.editorType=o.RMMZ,cc.director.loadScene("typeMenu")},this)},i.editorType=o.RMMZ,s([n(cc.Button)],i.prototype,"rmmvBtn",void 0),s([n(cc.Button)],i.prototype,"rmmzBtn",void 0),e=s([r],i)}(cc.Component);e.default=d,cc._RF.pop()},{}],mapOperScript:[function(t,i,e){"use strict";cc._RF.push(i,"82e7dfaOsNCTrZS+LWL2ARw","mapOperScript");var a,h=this&&this.__extends||(a=function(t,i){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,i)},function(t,i){function e(){this.constructor=t}a(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}),s=this&&this.__decorate||function(t,i,e,a){var h,s=arguments.length,o=s<3?i:null===a?a=Object.getOwnPropertyDescriptor(i,e):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,i,e,a);else for(var l=t.length-1;l>=0;l--)(h=t[l])&&(o=(s<3?h(o):s>3?h(i,e,o):h(i,e))||o);return s>3&&o&&Object.defineProperty(i,e,o),o};Object.defineProperty(e,"__esModule",{value:!0});var o=cc._decorator,l=o.ccclass,r=o.property,n=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.mapSprite=null,i.zoomIn=null,i.zoomOut=null,i.scaleLabel=null,i.zoomscale=1,i.ifPressed=!1,i}return h(i,t),i.prototype.start=function(){var t=this;this.mapSprite.node.on(cc.Node.EventType.TOUCH_START,function(){t.ifPressed=!0},this),this.mapSprite.node.on(cc.Node.EventType.TOUCH_MOVE,function(i){t.ifPressed&&(t.mapSprite.node.x+=i.touch._point.x-i.touch._prevPoint.x,t.mapSprite.node.y+=i.touch._point.y-i.touch._prevPoint.y)},this),this.mapSprite.node.on(cc.Node.EventType.TOUCH_END,function(){t.ifPressed=!1},this),this.zoomIn.node.on("click",function(){t.zoomscale+=.2,t.zoomscale<.01&&(t.zoomscale=.01),t.zoomscale>10&&(t.zoomscale=10),t.mapSprite.node.scale=t.zoomscale,t.scaleLabel.string=Math.round(100*t.zoomscale).toString()+"%"},this),this.zoomOut.node.on("click",function(){t.zoomscale-=.2,t.zoomscale<.01&&(t.zoomscale=.01),t.zoomscale>10&&(t.zoomscale=10),t.mapSprite.node.scale=t.zoomscale,t.scaleLabel.string=Math.round(100*t.zoomscale).toString()+"%"},this)},s([r(cc.Sprite)],i.prototype,"mapSprite",void 0),s([r(cc.Button)],i.prototype,"zoomIn",void 0),s([r(cc.Button)],i.prototype,"zoomOut",void 0),s([r(cc.Label)],i.prototype,"scaleLabel",void 0),s([l],i)}(cc.Component);e.default=n,cc._RF.pop()},{}],saveFile:[function(t,i,e){"use strict";cc._RF.push(i,"64369WZHzhOv4kKRM71h/Np","saveFile"),Object.defineProperty(e,"__esModule",{value:!0}),e.saveFile=void 0;var a=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!1,configurable:!0}),t.prototype.tostring=function(t,i,e,a){return'\n        {\n            "autoplayBgm": false,\n            "autoplayBgs": false,\n            "battleback1Name": "",\n            "battleback2Name": "",\n            "bgm": {\n              "name": "",\n              "pan": 0,\n              "pitch": 100,\n              "volume": 90\n            },\n            "bgs": {\n              "name": "",\n              "pan": 0,\n              "pitch": 100,\n              "volume": 90\n            },\n            "disableDashing": false,\n            "displayName": "",\n            "encounterList": [],\n            "encounterStep": 30,\n            "height": '+e+',\n            "note": "",\n            "parallaxLoopX": false,\n            "parallaxLoopY": false,\n            "parallaxName": "",\n            "parallaxShow": true,\n            "parallaxSx": 0,\n            "parallaxSy": 0,\n            "scrollType": 0,\n            "specifyBattleback": true,\n            "tilesetId": '+t+',\n            "width":'+i+',\n            "data":['+a+'],\n            "events":[]\n        }\n        '},t.prototype.saveMap=function(t,i,e){var a;if("function"==typeof window.Blob)a=new Blob([t],{type:i});else{var h=new(window.BlobBuilder||window.MozBlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder);h.append(t),a=h.getBlob(i)}var s=(window.URL||window.webkitURL).createObjectURL(a),o=document.createElement("a");if("download"in o){o.style.visibility="hidden",o.href=s,o.download=e,document.body.appendChild(o);var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!0),o.dispatchEvent(l),document.body.removeChild(o)}else navigator.msSaveBlob?navigator.msSaveBlob(a,e):location.href=s},t}();e.saveFile=a,cc._RF.pop()},{}],sketchOperScript:[function(t,i,e){"use strict";cc._RF.push(i,"0a2f5P6QTZOQ4cPkndQ3/Uk","sketchOperScript");var a,h=this&&this.__extends||(a=function(t,i){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,i)},function(t,i){function e(){this.constructor=t}a(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}),s=this&&this.__decorate||function(t,i,e,a){var h,s=arguments.length,o=s<3?i:null===a?a=Object.getOwnPropertyDescriptor(i,e):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,i,e,a);else for(var l=t.length-1;l>=0;l--)(h=t[l])&&(o=(s<3?h(o):s>3?h(i,e,o):h(i,e))||o);return s>3&&o&&Object.defineProperty(i,e,o),o};Object.defineProperty(e,"__esModule",{value:!0});var o=t("./MIcaveScript"),l=cc._decorator,r=l.ccclass,n=l.property,d=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.mapSprite=null,i.zoomIn=null,i.zoomOut=null,i.scaleLabel=null,i.zoomscale=1,i.ifPressed=!1,i}return h(i,t),i.prototype.start=function(){var t=this;this.mapSprite.node.on(cc.Node.EventType.TOUCH_START,function(i){t.ifPressed=!0,t.lastPos=t.mapSprite.node.convertToNodeSpaceAR(i.getLocation()),console.log(t.lastPos)},this),this.mapSprite.node.on(cc.Node.EventType.TOUCH_MOVE,function(i){if(t.ifPressed)if(o.default.operType===o.OperType.Pen){var e=t.mapSprite.node.convertToNodeSpaceAR(i.getLocation());if(e.x>o.default.newCanvas.width/2||e.x<-o.default.newCanvas.width/2||e.y>o.default.newCanvas.height/2||e.y<-o.default.newCanvas.height/2)return;t.mapSprite.spriteFrame.getTexture();for(var a=Math.round(o.default.newCanvas.width/2+t.lastPos.x),h=Math.round(o.default.newCanvas.height/2-t.lastPos.y),s=Math.round(o.default.newCanvas.width/2+e.x)-a,l=Math.round(o.default.newCanvas.height/2-e.y)-h,r=Math.abs(s)>Math.abs(l)?Math.abs(s):Math.abs(l),n=a,d=h,c=0;c<=r;c++)o.default.dataPath[Math.round(d)*o.default.newCanvas.height+Math.round(n)]=o.default.sketchType,o.default.dataPath[Math.round(d+1)*o.default.newCanvas.height+Math.round(n)]=o.default.sketchType,o.default.dataPath[Math.round(d)*o.default.newCanvas.height+Math.round(n+1)]=o.default.sketchType,o.default.dataPath[Math.round(d+1)*o.default.newCanvas.height+Math.round(n+1)]=o.default.sketchType,n+=s/r,d+=l/r;o.default.DrawSketch(o.default.newCanvas.width,o.default.newCanvas.height,t.mapSprite),t.lastPos=e}else o.default.operType===o.OperType.Move&&(t.mapSprite.node.x+=i.touch._point.x-i.touch._prevPoint.x,t.mapSprite.node.y+=i.touch._point.y-i.touch._prevPoint.y)},this),this.mapSprite.node.on(cc.Node.EventType.TOUCH_END,function(){t.ifPressed=!1},this),this.zoomIn.node.on("click",function(){t.zoomscale+=.2,t.zoomscale<.01&&(t.zoomscale=.01),t.zoomscale>10&&(t.zoomscale=10),t.mapSprite.node.scale=t.zoomscale,t.scaleLabel.string=Math.round(100*t.zoomscale).toString()+"%"},this),this.zoomOut.node.on("click",function(){t.zoomscale-=.2,t.zoomscale<.01&&(t.zoomscale=.01),t.zoomscale>10&&(t.zoomscale=10),t.mapSprite.node.scale=t.zoomscale,t.scaleLabel.string=Math.round(100*t.zoomscale).toString()+"%"},this)},s([n(cc.Sprite)],i.prototype,"mapSprite",void 0),s([n(cc.Button)],i.prototype,"zoomIn",void 0),s([n(cc.Button)],i.prototype,"zoomOut",void 0),s([n(cc.Label)],i.prototype,"scaleLabel",void 0),s([r],i)}(cc.Component);e.default=d,cc._RF.pop()},{"./MIcaveScript":"MIcaveScript"}],tileManager:[function(t,i,e){"use strict";cc._RF.push(i,"be05cSXPlxFH6Y5CRD2VNau","tileManager");var a,h=this&&this.__extends||(a=function(t,i){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,i)},function(t,i){function e(){this.constructor=t}a(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}),s=this&&this.__decorate||function(t,i,e,a){var h,s=arguments.length,o=s<3?i:null===a?a=Object.getOwnPropertyDescriptor(i,e):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,i,e,a);else for(var l=t.length-1;l>=0;l--)(h=t[l])&&(o=(s<3?h(o):s>3?h(i,e,o):h(i,e))||o);return s>3&&o&&Object.defineProperty(i,e,o),o};Object.defineProperty(e,"__esModule",{value:!0}),e.TileSet=e.Tile=e.Tilesetsdata=void 0;var o=t("./mainScript"),l=cc._decorator,r=l.ccclass;l.property,e.Tilesetsdata=[null,{id:1,mode:0,name:"\u4e16\u754c",note:"",tilesetNames:["World_A1","World_A2","","","","World_B","World_C","",""]},{id:2,mode:1,name:"\u5916\u89c2",note:"",tilesetNames:["Outside_A1","Outside_A2","Outside_A3","Outside_A4","Outside_A5","Outside_B","Outside_C","",""]},{id:3,mode:1,name:"\u5185\u90e8",note:"",tilesetNames:["Inside_A1","Inside_A2","","Inside_A4","Inside_A5","Inside_B","Inside_C","",""]},{id:4,mode:1,name:"\u5730\u4e0b\u57ce",note:"",tilesetNames:["Dungeon_A1","Dungeon_A2","","Dungeon_A4","Dungeon_A5","Dungeon_B","Dungeon_C","",""]},{id:5,mode:1,name:"\u8fd1\u672a\u6765\u5916\u89c2",note:"",tilesetNames:["Outside_A1","Outside_A2","SF_Outside_A3","SF_Outside_A4","SF_Outside_A5","SF_Outside_B","SF_Outside_C","",""]},{id:6,mode:1,name:"\u8fd1\u672a\u6765\u5185\u90e8",note:"",tilesetNames:["Inside_A1","Inside_A2","","SF_Inside_A4","SF_Outside_A5","SF_Inside_B","SF_Inside_C","",""]}];var n=function(){};e.Tile=n;var d=function(){function t(i){if(this.id=i,t.finished=0,this.name=e.Tilesetsdata[i].name,this.tiletextures=new Array(8192),""!==e.Tilesetsdata[i].tilesetNames[0]){var a="resources/"+o.default.editorType+"/"+e.Tilesetsdata[i].tilesetNames[0]+".png";this.A1=new Image,this.A1.crossOrigin="anonymous",this.A1.src=cc.url.raw(a);var h=this;this.A1.onload=function(){h.analyseA1(h.A1),t.finished++}}else t.finished++;if(""!==e.Tilesetsdata[i].tilesetNames[1]){a="resources/"+o.default.editorType+"/"+e.Tilesetsdata[i].tilesetNames[1]+".png",this.A2=new Image,this.A2.crossOrigin="anonymous",this.A2.src=cc.url.raw(a);var s=this;this.A2.onload=function(){s.analyseA2(s.A2),t.finished++}}else t.finished++;if(""!==e.Tilesetsdata[i].tilesetNames[2]){a="resources/"+o.default.editorType+"/"+e.Tilesetsdata[i].tilesetNames[2]+".png",this.A3=new Image,this.A3.crossOrigin="anonymous",this.A3.src=cc.url.raw(a);var l=this;this.A3.onload=function(){l.analyseA3(l.A3),t.finished++}}else t.finished++;if(""!==e.Tilesetsdata[i].tilesetNames[3]){a="resources/"+o.default.editorType+"/"+e.Tilesetsdata[i].tilesetNames[3]+".png",this.A4=new Image,this.A4.crossOrigin="anonymous",this.A4.src=cc.url.raw(a);var r=this;this.A4.onload=function(){r.analyseA4(r.A4),t.finished++}}else t.finished++;if(""!==e.Tilesetsdata[i].tilesetNames[4]){a="resources/"+o.default.editorType+"/"+e.Tilesetsdata[i].tilesetNames[4]+".png",this.A5=new Image,this.A5.crossOrigin="anonymous",this.A5.src=cc.url.raw(a);var d=this;this.A5.onload=function(){for(var i=0;i<16;i++)for(var e=0;e<16;e++)d.tiletextures[8*i+e+1536]=new n,d.tiletextures[8*i+e+1536].img=d.A5,d.tiletextures[8*i+e+1536].locUL=new cc.Vec2(48*e,48*i),d.tiletextures[8*i+e+1536].locUR=new cc.Vec2(48*e+24,48*i),d.tiletextures[8*i+e+1536].locDL=new cc.Vec2(48*e,48*i+24),d.tiletextures[8*i+e+1536].locDR=new cc.Vec2(48*e+24,48*i+24);t.finished++}}else t.finished++;if(""!==e.Tilesetsdata[i].tilesetNames[5]){a="resources/"+o.default.editorType+"/"+e.Tilesetsdata[i].tilesetNames[5]+".png",this.B=new Image,this.B.crossOrigin="anonymous",this.B.src=cc.url.raw(a);var c=this;this.B.onload=function(){for(var i=0;i<16;i++)for(var e=0;e<8;e++)c.tiletextures[8*i+e]=new n,c.tiletextures[8*i+e+128]=new n,c.tiletextures[8*i+e].img=c.B,c.tiletextures[8*i+e+128].img=c.B,c.tiletextures[8*i+e].locUL=new cc.Vec2(48*e,48*i),c.tiletextures[8*i+e].locUR=new cc.Vec2(48*e+24,48*i),c.tiletextures[8*i+e].locDL=new cc.Vec2(48*e,48*i+24),c.tiletextures[8*i+e].locDR=new cc.Vec2(48*e+24,48*i+24),c.tiletextures[8*i+e+128].locUL=new cc.Vec2(48*(8+e),48*i),c.tiletextures[8*i+e+128].locUR=new cc.Vec2(48*(8+e)+24,48*i),c.tiletextures[8*i+e+128].locDL=new cc.Vec2(48*(8+e),48*i+24),c.tiletextures[8*i+e+128].locDR=new cc.Vec2(48*(8+e)+24,48*i+24);t.finished++}}else t.finished++;if(""!==e.Tilesetsdata[i].tilesetNames[6]){a="resources/"+o.default.editorType+"/"+e.Tilesetsdata[i].tilesetNames[6]+".png",this.C=new Image,this.C.crossOrigin="anonymous",this.C.src=cc.url.raw(a);var p=this;this.C.onload=function(){for(var i=0;i<16;i++)for(var e=0;e<8;e++)p.tiletextures[8*i+e+256]=new n,p.tiletextures[8*i+e+384]=new n,p.tiletextures[8*i+e+256].img=p.C,p.tiletextures[8*i+e+384].img=p.C,p.tiletextures[8*i+e+256].locUL=new cc.Vec2(48*e,48*i),p.tiletextures[8*i+e+256].locUR=new cc.Vec2(48*e+24,48*i),p.tiletextures[8*i+e+256].locDL=new cc.Vec2(48*e,48*i+24),p.tiletextures[8*i+e+256].locDR=new cc.Vec2(48*e+24,48*i+24),p.tiletextures[8*i+e+384].locUL=new cc.Vec2(48*(8+e),48*i),p.tiletextures[8*i+e+384].locUR=new cc.Vec2(48*(8+e)+24,48*i),p.tiletextures[8*i+e+384].locDL=new cc.Vec2(48*(8+e),48*i+24),p.tiletextures[8*i+e+384].locDR=new cc.Vec2(48*(8+e)+24,48*i+24);t.finished++}}else t.finished++;if(""!==e.Tilesetsdata[i].tilesetNames[7]){a="resources/"+o.default.editorType+"/"+e.Tilesetsdata[i].tilesetNames[7]+".png",this.D=new Image,this.D.crossOrigin="anonymous",this.D.src=cc.url.raw(a);var f=this;this.D.onload=function(){for(var i=0;i<16;i++)for(var e=0;e<8;e++)f.tiletextures[8*i+e+512]=new n,f.tiletextures[8*i+e+640]=new n,f.tiletextures[8*i+e+512].img=f.D,f.tiletextures[8*i+e+640].img=f.D,f.tiletextures[8*i+e+512].locUL=new cc.Vec2(48*e,48*i),f.tiletextures[8*i+e+512].locUR=new cc.Vec2(48*e+24,48*i),f.tiletextures[8*i+e+512].locDL=new cc.Vec2(48*e,48*i+24),f.tiletextures[8*i+e+512].locDR=new cc.Vec2(48*e+24,48*i+24),f.tiletextures[8*i+e+640].locUL=new cc.Vec2(48*(8+e),48*i),f.tiletextures[8*i+e+640].locUR=new cc.Vec2(48*(8+e)+24,48*i),f.tiletextures[8*i+e+640].locDL=new cc.Vec2(48*(8+e),48*i+24),f.tiletextures[8*i+e+640].locDR=new cc.Vec2(48*(8+e)+24,48*i+24);t.finished++}}else t.finished++;if(""!==e.Tilesetsdata[i].tilesetNames[8]){a="resources/"+o.default.editorType+"/"+e.Tilesetsdata[i].tilesetNames[8]+".png",this.E=new Image,this.E.crossOrigin="anonymous",this.E.src=cc.url.raw(a);var u=this;this.E.onload=function(){for(var i=0;i<16;i++)for(var e=0;e<8;e++)u.tiletextures[8*i+e+768]=new n,u.tiletextures[8*i+e+896]=new n,u.tiletextures[8*i+e+768].img=u.E,u.tiletextures[8*i+e+896].img=u.E,u.tiletextures[8*i+e+768].locUL=new cc.Vec2(48*e,48*i),u.tiletextures[8*i+e+768].locUR=new cc.Vec2(48*e+24,48*i),u.tiletextures[8*i+e+768].locDL=new cc.Vec2(48*e,48*i+24),u.tiletextures[8*i+e+768].locDR=new cc.Vec2(48*e+24,48*i+24),u.tiletextures[8*i+e+896].locUL=new cc.Vec2(48*(8+e),48*i),u.tiletextures[8*i+e+896].locUR=new cc.Vec2(48*(8+e)+24,48*i),u.tiletextures[8*i+e+896].locDL=new cc.Vec2(48*(8+e),48*i+24),u.tiletextures[8*i+e+896].locDR=new cc.Vec2(48*(8+e)+24,48*i+24);t.finished++}}else t.finished++}return t.prototype.analyseA1=function(t){this.generateFloor(t,0,0,96,144,2048),this.generateFloor(t,288,0,96,144,2144),this.generateFloor(t,384,0,96,144,2240),this.generateFloor(t,0,144,96,144,2096),this.generateFloor(t,288,144,96,144,2192),this.generateFloor(t,384,144,96,144,2336),this.generateFloor(t,0,288,96,144,2432),this.generateFloor(t,384,288,96,144,2624),this.generateFloor(t,0,432,96,144,2528),this.generateFloor(t,384,432,96,144,2720)},t.prototype.analyseA2=function(t){for(var i=0;i<4;i++)for(var e=0;e<8;e++)this.generateFloor(t,96*e,144*i,96,144,2816+48*(8*i+e))},t.prototype.analyseA3=function(t){for(var i=0;i<4;i++)for(var e=0;e<8;e++)this.generateWall(t,96*e,96*i,96,96,4352+48*(8*i+e))},t.prototype.analyseA4=function(t){for(var i=0;i<3;i++)for(var e=0;e<8;e++)this.generateFloor(t,96*e,240*i,96,144,5888+48*e+768*i),this.generateWall(t,96*e,240*i+144,96,96,6272+48*e+768*i)},t.prototype.generateFloor=function(t,i,e,a,h,s){var o=[];o[0]=[18,17,14,13],o[1]=[2,17,14,13],o[2]=[18,3,14,13],o[3]=[2,3,14,13],o[4]=[18,17,14,7],o[5]=[2,17,14,7],o[6]=[18,3,14,7],o[7]=[2,3,14,7],o[8]=[18,17,6,13],o[9]=[2,17,6,13],o[10]=[18,3,6,13],o[11]=[2,3,6,13],o[12]=[18,17,6,7],o[13]=[2,17,6,7],o[14]=[18,3,6,7],o[15]=[2,3,6,7],o[16]=[16,17,12,13],o[17]=[16,3,12,13],o[18]=[16,17,12,7],o[19]=[16,3,12,7],o[20]=[10,9,14,13],o[21]=[10,9,14,7],o[22]=[10,9,6,13],o[23]=[10,9,6,7],o[24]=[18,19,14,15],o[25]=[18,19,6,15],o[26]=[2,19,14,15],o[27]=[2,19,6,15],o[28]=[18,17,22,21],o[29]=[2,17,22,21],o[30]=[18,3,22,21],o[31]=[2,3,22,21],o[32]=[16,19,12,15],o[33]=[10,9,22,21],o[34]=[8,9,12,13],o[35]=[8,9,12,7],o[36]=[10,11,14,15],o[37]=[10,11,6,15],o[38]=[18,19,22,23],o[39]=[2,19,22,23],o[40]=[16,17,20,21],o[41]=[16,3,20,21],o[42]=[8,11,12,15],o[43]=[8,9,20,21],o[44]=[16,19,20,23],o[45]=[10,11,22,23],o[46]=[8,11,20,23],o[47]=[0,1,4,5];for(var l=0;l<48;l++){this.tiletextures[s+l]=new n,this.tiletextures[s+l].img=t;var r=o[l][0]%4*24,d=24*Math.floor(o[l][0]/4),c=o[l][1]%4*24,p=24*Math.floor(o[l][1]/4),f=o[l][2]%4*24,u=24*Math.floor(o[l][2]/4),w=o[l][3]%4*24,g=24*Math.floor(o[l][3]/4);this.tiletextures[s+l].locUL=new cc.Vec2(i+r,e+d),this.tiletextures[s+l].locUR=new cc.Vec2(i+c,e+p),this.tiletextures[s+l].locDL=new cc.Vec2(i+f,e+u),this.tiletextures[s+l].locDR=new cc.Vec2(i+w,e+g)}},t.prototype.generateWall=function(t,i,e,a,h,s){var o=[];o[0]=[10,9,6,5],o[1]=[8,9,4,5],o[2]=[2,1,6,5],o[3]=[0,1,4,5],o[4]=[10,11,6,7],o[5]=[8,11,4,7],o[6]=[2,3,6,7],o[7]=[0,3,4,7],o[8]=[10,9,14,13],o[9]=[8,9,12,13],o[10]=[2,1,14,13],o[11]=[0,1,12,13],o[12]=[10,11,14,15],o[13]=[8,11,12,15],o[14]=[2,3,14,15],o[15]=[0,3,12,15];for(var l=0;l<16;l++){this.tiletextures[s+l]=new n,this.tiletextures[s+l].img=t;var r=o[l][0]%4*24,d=24*Math.floor(o[l][0]/4),c=o[l][1]%4*24,p=24*Math.floor(o[l][1]/4),f=o[l][2]%4*24,u=24*Math.floor(o[l][2]/4),w=o[l][3]%4*24,g=24*Math.floor(o[l][3]/4);this.tiletextures[s+l].locUL=new cc.Vec2(i+r,e+d),this.tiletextures[s+l].locUR=new cc.Vec2(i+c,e+p),this.tiletextures[s+l].locDL=new cc.Vec2(i+f,e+u),this.tiletextures[s+l].locDR=new cc.Vec2(i+w,e+g)}},t}();e.TileSet=d;var c=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}var e;return h(i,t),e=i,i.prototype.start=function(){e.tileSets=[];for(var t=1;t<7;t++)e.tileSets.push(new d(t))},e=s([r],i)}(cc.Component);e.default=c,cc._RF.pop()},{"./mainScript":"mainScript"}],typeScript:[function(t,i,e){"use strict";cc._RF.push(i,"53e8cSxrS5IP7X6tmtSYE4K","typeScript");var a,h=this&&this.__extends||(a=function(t,i){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,i)},function(t,i){function e(){this.constructor=t}a(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}),s=this&&this.__decorate||function(t,i,e,a){var h,s=arguments.length,o=s<3?i:null===a?a=Object.getOwnPropertyDescriptor(i,e):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,i,e,a);else for(var l=t.length-1;l>=0;l--)(h=t[l])&&(o=(s<3?h(o):s>3?h(i,e,o):h(i,e))||o);return s>3&&o&&Object.defineProperty(i,e,o),o};Object.defineProperty(e,"__esModule",{value:!0});var o=t("./mainScript"),l=cc._decorator,r=l.ccclass,n=l.property,d=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.title=null,i.caveBtn=null,i.wildBtn=null,i.MIcaveBtn=null,i}return h(i,t),i.prototype.start=function(){this.title.string="Map Generator for "+o.default.editorType,this.caveBtn.node.on("click",function(){cc.director.loadScene("caveScene")},this),this.wildBtn.node.on("click",function(){cc.director.loadScene("wildScene")},this),this.MIcaveBtn.node.on("click",function(){cc.director.loadScene("MIcaveScene")},this)},s([n(cc.Label)],i.prototype,"title",void 0),s([n(cc.Button)],i.prototype,"caveBtn",void 0),s([n(cc.Button)],i.prototype,"wildBtn",void 0),s([n(cc.Button)],i.prototype,"MIcaveBtn",void 0),s([r],i)}(cc.Component);e.default=d,cc._RF.pop()},{"./mainScript":"mainScript"}],wildScript:[function(t,i,e){"use strict";cc._RF.push(i,"2a4793Zu0pCaqKwPFkK4Q66","wildScript");var a,h=this&&this.__extends||(a=function(t,i){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,i)},function(t,i){function e(){this.constructor=t}a(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}),s=this&&this.__decorate||function(t,i,e,a){var h,s=arguments.length,o=s<3?i:null===a?a=Object.getOwnPropertyDescriptor(i,e):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,i,e,a);else for(var l=t.length-1;l>=0;l--)(h=t[l])&&(o=(s<3?h(o):s>3?h(i,e,o):h(i,e))||o);return s>3&&o&&Object.defineProperty(i,e,o),o};Object.defineProperty(e,"__esModule",{value:!0});var o=t("./mainScript"),l=t("./saveFile"),r=t("./tileManager"),n=cc._decorator,d=n.ccclass,c=n.property,p=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.genBtn=null,i.widthText=null,i.heightText=null,i.typeToggle=null,i.mapSprite=null,i.ornamentsNode=null,i.ornamentsSlider=null,i.densityLabel=null,i.ornamentsBtn=null,i.clearBtn=null,i.saveBtn=null,i.width=10,i.height=10,i.ornamentsdensity=.3,i.tilesetId=2,i.data1=[],i.data2=[],i.data3=[],i.data4=[],i.data5=[],i.data6=[],i.eightX=[-1,0,1,-1,1,-1,0,1],i.eightY=[-1,-1,-1,0,0,1,1,1],i.fourX=[-1,1,0,0],i.fourY=[0,0,-1,1],i.Base=1553,i.Base2=3296,i.Wall=6320,i.WallTop=5936,i.Stone1=[],i.prob1=[],i.Stone21=65,i.Stone22=73,i.WalkableStone=49,i.WalkableBase=1625,i.Hole=3392,i.Lake=2528,i.WallDecTop=[],i.probWallTop=[],i.WallDecDown=[],i.probWallDown=[],i.Wall21=[],i.Wall22=[],i.probWall2=[],i.widthmargin=3,i.heightmargin=3,i}var e;return h(i,t),e=i,i.prototype.start=function(){for(var t=this,i=function(t){a.typeToggle.node.children[t].on("click",function(){e.typeSeleceted=t},a)},a=this,h=0;h<this.typeToggle.node.children.length;h++)i(h);this.genBtn.node.on("click",function(){t.width=+t.widthText.string,t.height=+t.heightText.string,!t.width||t.width<=0||NaN===t.width?alert("\u8bf7\u8f93\u5165\u6709\u6548\u7684\u5730\u56fe\u5bbd\u5ea6\nPlease enter a valid map width"):!t.height||t.height<=0||NaN===t.height?alert("\u8bf7\u8f93\u5165\u6709\u6548\u7684\u5730\u56fe\u9ad8\u5ea6\nPlease enter a valid map height"):t.generateMap()},this),this.ornamentsSlider.node.on("slide",function(){t.ornamentsdensity=t.ornamentsSlider.progress,t.densityLabel.string=Math.floor(100*t.ornamentsdensity)+"%"},this),this.ornamentsBtn.node.on("click",function(){t.cleardeco(),t.adddeco(),t.DrawMap(),t.ornamentsBtn.getComponentInChildren(cc.Label).string="Refresh Ornaments(\u91cd\u65b0\u88c5\u9970)"},this),this.clearBtn.node.on("click",function(){t.cleardeco(),t.DrawMap()},this),this.saveBtn.node.on("click",function(){l.saveFile.instance.saveMap(l.saveFile.instance.tostring(t.tilesetId+1,t.width,t.height,t.data),"application/json","test")},this)},i.prototype.genstr=function(){for(var t=this.width,i=this.height,e="",a=0;a<=5;a++)for(var h=0;h<t*i;h++)0==a&&0==h||(e+=","),e+=this.data[a*t*i+h].toString();return e},i.prototype.generateMap=function(){this.data1=[],this.data2=[],this.data3=[],this.data4=[],this.data5=[],this.data6=[];for(var t=0;t<this.height;t++)for(var i=0;i<this.width;i++)this.data1.push(0),this.data2.push(0),this.data3.push(0),this.data4.push(0),this.data5.push(0),this.data6.push(0);this.initTilesType(),this.width<=25&&this.height<=25?this.initSmallRandomMap():(this.initRandomMap(),this.autoCell()),this.connectAllBase(),this.generateLakeandHole(),this.generateWall(),this.fillWallTops(),this.generateBase2(),this.updateAutoTiles(),this.data=this.data1.concat(this.data2.concat(this.data3.concat(this.data4.concat(this.data5.concat(this.data6))))),this.DrawMap()},i.prototype.DrawMap=function(){var t=new cc.RenderTexture,i=document.createElement("canvas");i.width=48*this.width,i.height=48*this.height;for(var e=i.getContext("2d"),a=0;a<this.data.length;a++){var h=Math.floor(a/(this.width*this.height)),s=a%(this.width*this.height),o=Math.floor(s/this.width),l=s%this.width,n=this.data[a];if(h<4&&n>0&&n<8192){var d=48*l,c=48*o,p=r.default.tileSets[this.tilesetId].tiletextures[n].img,f=r.default.tileSets[this.tilesetId].tiletextures[n].locUL,u=r.default.tileSets[this.tilesetId].tiletextures[n].locUR,w=r.default.tileSets[this.tilesetId].tiletextures[n].locDL,g=r.default.tileSets[this.tilesetId].tiletextures[n].locDR;e.drawImage(p,f.x,f.y,24,24,d,c,24,24),e.drawImage(p,u.x,u.y,24,24,d+24,c,24,24),e.drawImage(p,w.x,w.y,24,24,d,c+24,24,24),e.drawImage(p,g.x,g.y,24,24,d+24,c+24,24,24)}}t.initWithElement(i);var y=new cc.SpriteFrame(t);this.mapSprite.spriteFrame=y,this.ornamentsNode.active=!0},i.prototype.fillFlood=function(t,i,e,a,h){var s=[],o=new cc.Vec2(e,a);s.push(o),h[a*this.width+e]=i;for(var l=0;l<s.length;){var r=s[l];l++;for(var n=0;n<4;n++){var d=new cc.Vec2(r.x+this.fourX[n],r.y+this.fourY[n]);this.data1[d.y*this.width+d.x]===t&&h[d.y*this.width+d.x]!=i&&(h[d.y*this.width+d.x]=i,s.push(d))}}return s},i.prototype.initTilesType=function(){0===e.typeSeleceted?(this.Base=2816,this.Base2=2912,this.Wall=6272,this.WallTop=5888,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[56,108,9,242],this.Stone21=64,this.Stone22=72,this.WalkableStone=48,this.WallDecTop=[144,0],this.Wall21=[153,0],this.Wall22=[161,0]):(this.Stone1=[40,124,199,242],this.Stone21=48,this.Stone22=56,this.WalkableStone=32,this.WallDecTop=[176,0],this.Wall21=[185,0],this.Wall22=[193,0]),this.WalkableBase=1624,this.Hole=3008,this.Lake=2432,this.prob1=[0,.4,.8,.9],this.probWall2=[0,.1],this.probWallTop=[0,.1],this.WallDecDown=[0],this.probWallDown=[0]):1===e.typeSeleceted?(this.Base=3200,this.Base2=3296,this.Wall=6320,this.WallTop=5936,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[57,104,167,242],this.Stone21=65,this.Stone22=73,this.WalkableStone=49,this.WallDecTop=[155,144,165,0],this.Wall21=[152,153,154,0],this.Wall22=[160,161,162,0],this.WallDecDown=[163,167,0]):(this.Stone1=[41,120,190,242],this.Stone21=49,this.Stone22=57,this.WalkableStone=33,this.WallDecTop=[187,176,196,0],this.Wall21=[184,185,186,0],this.Wall22=[192,193,194,0],this.WallDecDown=[1,190,0]),this.prob1=[0,.4,.8,.9],this.WalkableBase=1625,this.Hole=3392,this.Lake=2528,this.probWall2=[0,.1,.2,.3],this.probWallTop=[0,.1,.2,.4],this.probWallDown=[0,.1,.3]):2===e.typeSeleceted?(this.Base=3584,this.Base2=3680,this.Wall=6368,this.WallTop=5984,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[58,242],this.Stone21=66,this.Stone22=74,this.WalkableStone=50,this.Wall21=[156,0],this.Wall22=[164,0]):(this.Stone1=[42,242],this.Stone21=50,this.Stone22=58,this.WalkableStone=34,this.Wall21=[187,0],this.Wall22=[195,0]),this.prob1=[0,.9],this.WalkableBase=1626,this.Hole=3776,this.Lake=2240,this.probWall2=[0,.1],this.WallDecTop=[0],this.probWallTop=[0],this.WallDecDown=[0],this.probWallDown=[0]):3===e.typeSeleceted?(this.Base=3968,this.Base2=4064,this.Wall=6416,this.WallTop=6032,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[59,106],this.Stone21=67,this.Stone22=75,this.WalkableStone=51,this.WallDecTop=[166,0],this.WallDecDown=[158,0],this.Wall21=[157,0],this.Wall22=[165,0]):(this.Stone1=[43,122],this.Stone21=51,this.Stone22=59,this.WalkableStone=35,this.WallDecTop=[197,0],this.WallDecDown=[189,0],this.Wall21=[188,0],this.Wall22=[196,0]),this.prob1=[0,.9],this.WalkableBase=1627,this.Hole=3440,this.Lake=3440,this.probWall2=[0,.1],this.probWallTop=[0,.1],this.probWallDown=[0,.1]):4===e.typeSeleceted?(this.Base=2864,this.Base2=2960,this.Wall=6464,this.WallTop=6080,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[1,9,60,105,48,242],this.Stone21=68,this.Stone22=76,this.Wall21=[152,154],this.Wall22=[160,162],this.WallDecTop=[155,144],this.WallDecDown=[163,155],this.WalkableStone=52):(this.Stone1=[191,199,44,121,32,242],this.Stone21=52,this.Stone22=60,this.Wall21=[184,186],this.Wall22=[192,194],this.WallDecTop=[9,176],this.WallDecDown=[1,9],this.WalkableStone=36),this.prob1=[0,.2,.4,.6,.8,.9],this.WalkableBase=1628,this.Hole=3056,this.Lake=2336,this.probWall2=[0,.5],this.probWallTop=[0,.9],this.probWallDown=[0,.7]):5===e.typeSeleceted?(this.Base=3248,this.Base2=3344,this.Wall=6512,this.WallTop=6128,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[61],this.Stone21=69,this.Stone22=77,this.WalkableStone=53):(this.Stone1=[45],this.Stone21=53,this.Stone22=61,this.WalkableStone=37),this.prob1=[0],this.WalkableBase=1629,this.Hole=4160,this.Lake=2624,this.Wall21=[0],this.Wall22=[0],this.probWall2=[0],this.WallDecTop=[0],this.probWallTop=[0],this.WallDecDown=[0],this.probWallDown=[0]):6===e.typeSeleceted?(this.Base=3632,this.Base2=3632,this.Wall=6560,this.WallTop=6176,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[62],this.Stone21=70,this.Stone22=78,this.WalkableStone=54):(this.Stone1=[46],this.Stone21=54,this.Stone22=62,this.WalkableStone=38),this.prob1=[0],this.WalkableBase=1630,this.Hole=3824,this.Lake=3824,this.Wall21=[0],this.Wall22=[0],this.probWall2=[0],this.WallDecTop=[0],this.probWallTop=[0],this.WallDecDown=[0],this.probWallDown=[0]):7===e.typeSeleceted&&(this.Base=4016,this.Base2=4016,this.Wall=6608,this.WallTop=6224,o.default.editorType==o.EditorType.RMMV?(this.Stone1=[63,62,61],this.Stone21=71,this.Stone22=79,this.WalkableStone=55,this.Wall21=[153,0],this.Wall22=[161,0],this.WallDecTop=[144,0]):(this.Stone1=[47,46,45],this.Stone21=55,this.Stone22=63,this.WalkableStone=39,this.Wall21=[185,0],this.Wall22=[193,0],this.WallDecTop=[176,0]),this.prob1=[0,.4,.7],this.WalkableBase=1631,this.Hole=4208,this.Lake=4208,this.probWall2=[0,.2],this.probWallTop=[0,.1],this.WallDecDown=[0],this.probWallDown=[0])},i.prototype.initSmallRandomMap=function(){if(!(this.width<2*this.widthmargin+1||this.height<2*this.heightmargin+1))for(var t=2+Math.floor(Math.random()*this.width*this.height/6),i=0;i<t;i++){var e=this.widthmargin+Math.floor(Math.random()*(this.width-2*this.widthmargin)),a=this.heightmargin+Math.floor(Math.random()*(this.height-2*this.heightmargin));this.data1[a*this.width+e]=this.Base}},i.prototype.initRandomMap=function(){this.widthmargin=3,this.heightmargin=3;for(var t=0;t<this.height;t++)for(var i=0;i<this.width;i++)i>this.widthmargin&&i<this.width-this.widthmargin&&t>this.heightmargin&&t<this.height-this.heightmargin&&(this.data1[t*this.width+i]=2*Math.random()<1?0:this.Base)},i.prototype.autoCell=function(){for(var t=100,i=new Array(this.data1.length),e=0;e<this.data1.length;e++)i[e]=this.data1[e];for(;t>0;){for(t--,e=this.heightmargin;e<this.height-this.heightmargin;e++)for(var a=this.widthmargin;a<this.width-this.widthmargin;a++){for(var h=0,s=e-1;s<=e+1;s++)for(var o=a-1;o<=a+1;o++)s==e&&o==a||i[s*this.width+o]==this.Base&&h++;h>4?this.data1[e*this.width+a]=this.Base:h<4&&(this.data1[e*this.width+a]=0)}for(e=0;e<this.data1.length;e++)i[e]=this.data1[e]}},i.prototype.connectAllBase=function(){for(var t=new Array(this.height*this.width),i=[],e=0;e<this.height;e++)for(var a=0;a<this.width;a++)t[e*this.width+a]=-1;var h=0;for(e=0;e<this.height;e++)for(a=0;a<this.width;a++)if(this.data1[e*this.width+a]===this.Base&&-1===t[e*this.width+a]){var s=this.fillFlood(this.Base,h,a,e,t);i.push(s),h++}if(1!==i.length){var o=0,l=0;for(e=0;e<i.length;e++)i[e].length>l&&(o=e,l=i[e].length);for(e=0;e<i.length;e++)if(e!==o){var r=[];for(a=0;a<10;a++){var n=[],d=i[e][Math.floor(Math.random()*i[e].length)];n.push(d),r.push(n)}for(var c=-1;;){for(a=0;a<10;a++){var p=r[a][r[a].length-1],f=Math.floor(4*Math.random()),u=new cc.Vec2(p.x+this.fourX[f],p.y+this.fourY[f]);if(u.x>=this.widthmargin&&u.x<this.width-this.widthmargin&&u.y>=this.heightmargin&&u.y<this.height-this.heightmargin&&(r[a].push(u),t[u.y*this.width+u.x]===o)){c=a;break}}if(c>=0){for(a=0;a<r[c].length;a++)p=r[c][a],this.data1[p.y*this.width+p.x]=this.Base,t[p.y*this.width+p.x]=o;for(a=0;a<i[e].length;a++)t[(p=i[e][a]).y*this.width+p.x]=o;break}}}}},i.prototype.generateLakeandHole=function(){for(var t=new Array(this.height*this.width),i=[],e=0;e<this.height;e++)for(var a=0;a<this.width;a++)t[e*this.width+a]=-1;var h=0;for(e=0;e<this.height;e++)for(a=0;a<this.width;a++)if(0===this.data1[e*this.width+a]&&-1===t[e*this.width+a]){var s=this.fillFlood(0,h,a,e,t);i.push(s),h++}for(e=1;e<i.length;e++)if(Math.random()<.5)if(Math.random()<.5)for(a=0;a<i[e].length;a++)this.data1[i[e][a].y*this.width+i[e][a].x]=this.Hole;else for(a=0;a<i[e].length;a++)this.data1[i[e][a].y*this.width+i[e][a].x]=this.Lake},i.prototype.generateWall=function(){for(var t=this.height-2;t>2;t--)for(var i=this.width-2;i>2;i--)this.data1[t*this.width+i]===this.Base&&this.data1[(t-2)*this.width+i]===this.Base&&(this.data1[(t-1)*this.width+i]=this.Base),this.data1[t*this.width+i]===this.Base&&this.data1[(t-3)*this.width+i]===this.Base&&(this.data1[(t-1)*this.width+i]=this.Base,this.data1[(t-2)*this.width+i]=this.Base);for(t=this.height-2;t>=2;t--)for(i=this.width-1;i>0;i--)this.data1[t*this.width+i]===this.Base&&0===this.data1[(t-1)*this.width+i]&&0===this.data1[(t-2)*this.width+i]&&(this.data1[(t-1)*this.width+i]=this.Wall,t-3>=0&&0===this.data1[(t-3)*this.width+i]&&(this.data1[(t-2)*this.width+i]=this.Wall));for(t=1;t<this.height-1;t++)for(i=1;i<this.width-1;i++)if(0===this.data1[t*this.width+i])for(var e=0;e<8;e++){var a=this.data1[(t+this.eightY[e])*this.width+i+this.eightX[e]];a!==this.Wall&&a!==this.Base||(this.data1[t*this.width+i]=this.WallTop)}},i.prototype.fillWallTops=function(){for(var t=0;t<this.height;t++)for(var i=0;i<this.width;i++)0===this.data1[t*this.width+i]&&(this.data1[t*this.width+i]=this.WallTop)},i.prototype.generateBase2=function(){if(this.Base2!==this.Base)for(var t=Math.floor(Math.random()*Math.sqrt(this.width+this.height)),i=0;i<t;i++){var e=1+Math.floor(Math.random()*this.width-2),a=1+Math.floor(Math.random()*this.height-2);if(this.data1[a*this.width+e]===this.Base){var h=Math.floor(5*Math.random()),s=Math.floor(5*Math.random()),o=Math.floor(5*Math.random()),l=Math.floor(5*Math.random());this.renderBase2(e,a,h,o,l,s)}else i--}},i.prototype.renderBase2=function(t,i,e,a,h,s){var o=0;if(this.data1[i*this.width+t]===this.Base||this.data1[i*this.width+t]===this.Base2){for(var l=0;l<8;l++){var r=t+this.eightX[l],n=i+this.eightY[l];this.data1[n*this.width+r]!==this.Base&&this.data1[n*this.width+r]!==this.Base2||o++}if(o>=7){this.data1[i*this.width+t]=this.Base2;for(var d=0;d<4;d++)0==d&&e>0&&this.renderBase2(t+this.fourX[d],i+this.fourY[d],e-1,e-1,e-1,e-1),1==d&&a>0&&this.renderBase2(t+this.fourX[d],i+this.fourY[d],a-1,a-1,a-1,a-1),2==d&&h>0&&this.renderBase2(t+this.fourX[d],i+this.fourY[d],h-1,h-1,h-1,h-1),3==d&&s>0&&this.renderBase2(t+this.fourX[d],i+this.fourY[d],s-1,s-1,s-1,s-1)}}},i.prototype.updateAutoTiles=function(){for(var t=new Array(this.data1.length),i=0;i<this.data1.length;i++)t[i]=this.data1[i];for(var e=!0;e;)for(e=!1,i=1;i<this.height-1;i++)for(var a=1;a<this.width-1;a++){var h=this.data1[(i-1)*this.width+a-1],s=this.data1[(i-1)*this.width+a],o=this.data1[(i-1)*this.width+a+1],l=this.data1[i*this.width+a-1],r=this.data1[i*this.width+a+1],n=this.data1[(i+1)*this.width+a-1],d=this.data1[(i+1)*this.width+a],c=this.data1[(i+1)*this.width+a+1],p=this.data1[i*this.width+a];t[i*this.width+a]===this.Wall&&(this.data1[i*this.width+a]=this.updateWall(t[i*this.width+a],h,s,o,l,r,n,d,c),p!==this.data1[i*this.width+a]&&(e=!0)),t[i*this.width+a]===this.Base2&&this.Base2!==this.Base&&(this.data1[i*this.width+a]=this.updateFloor(t[i*this.width+a],h,s,o,l,r,n,d,c),p!==this.data1[i*this.width+a]&&(e=!0)),t[i*this.width+a]===this.WallTop&&(this.data1[i*this.width+a]=this.updateFloor(t[i*this.width+a],h,s,o,l,r,n,d,c),p!==this.data1[i*this.width+a]&&(e=!0)),t[i*this.width+a]===this.Hole&&(this.data1[i*this.width+a]=this.updateFloor(t[i*this.width+a],h,s,o,l,r,n,d,c),p!==this.data1[i*this.width+a]&&(e=!0)),t[i*this.width+a]===this.Lake&&(this.data1[i*this.width+a]=this.updateFloor(t[i*this.width+a],h,s,o,l,r,n,d,c),p!==this.data1[i*this.width+a]&&(e=!0))}},i.prototype.updateWall=function(t,i,e,a,h,s,o,l){var r=!0,n=!0,d=!0,c=!0;e<t||e>t+15?r=!1:(e%2==1&&(d=!1),Math.floor(e/4)%2==1&&(c=!1)),l<t||l>t+15?n=!1:(l%2==1&&(d=!1),Math.floor(l/4)%2==1&&(c=!1)),(h<t||h>t+15)&&(d=!1),(s<t||s>t+15)&&(c=!1);var p=t;return!1===d&&(p+=1),!1===c&&(p+=4),!1===r&&(p+=2),!1===n&&(p+=8),p},i.prototype.updateFloor=function(t,i,e,a,h,s,o,l,r){var n=!0,d=!0,c=!0,p=!0,f=!0,u=!0,w=!0,g=!0;(i<t||i>t+48)&&(n=!1),(e<t||e>t+48)&&(d=!1),(a<t||a>t+48)&&(c=!1),(h<t||h>t+48)&&(w=!1),(s<t||s>t+48)&&(g=!1),(o<t||o>t+48)&&(p=!1),(l<t||l>t+48)&&(f=!1),(r<t||r>t+48)&&(u=!1);var y=t;return c=!c,w=!w,g=!g,p=!p,f=!f,u=!u,(d=!d)||w||g||f||(y+=0),!(n=!n)||d||c||w||g||p||f||u||(y+=1),n||d||!c||w||g||p||f||u||(y+=2),!n||d||!c||w||g||p||f||u||(y+=3),n||d||c||w||g||p||f||!u||(y+=4),!n||d||c||w||g||p||f||!u||(y+=5),n||d||!c||w||g||p||f||!u||(y+=6),!n||d||!c||w||g||p||f||!u||(y+=7),n||d||c||w||g||!p||f||u||(y+=8),!n||d||c||w||g||!p||f||u||(y+=9),n||d||!c||w||g||!p||f||u||(y+=10),!n||d||!c||w||g||!p||f||u||(y+=11),n||d||c||w||g||!p||f||!u||(y+=12),!n||d||c||w||g||!p||f||!u||(y+=13),n||d||!c||w||g||!p||f||!u||(y+=14),n&&!d&&c&&!w&&!g&&p&&!f&&u&&(y+=15),d||c||!w||g||f||u||(y+=16),d||!c||!w||g||f||u||(y+=17),d||c||!w||g||f||!u||(y+=18),!d&&c&&w&&!g&&!f&&u&&(y+=19),!d||w||g||p||f||u||(y+=20),!d||w||g||p||f||!u||(y+=21),!d||w||g||!p||f||u||(y+=22),d&&!w&&!g&&p&&!f&&u&&(y+=23),n||d||w||!g||p||f||(y+=24),n||d||w||!g||!p||f||(y+=25),!n||d||w||!g||p||f||(y+=26),n&&!d&&!w&&g&&p&&!f&&(y+=27),n||d||c||w||g||!f||(y+=28),!n||d||c||w||g||!f||(y+=29),n||d||!c||w||g||!f||(y+=30),n&&!d&&c&&!w&&!g&&f&&(y+=31),!d&&w&&g&&!f&&(y+=32),d&&!w&&!g&&f&&(y+=33),!d||!w||g||f||u||(y+=34),d&&w&&!g&&!f&&u&&(y+=35),!d||w||!g||p||f||(y+=36),d&&!w&&g&&p&&!f&&(y+=37),n||d||w||!g||!f||(y+=38),n&&!d&&!w&&g&&f&&(y+=39),d||c||!w||g||!f||(y+=40),!d&&c&&w&&!g&&f&&(y+=41),d&&w&&g&&!f&&(y+=42),d&&w&&!g&&f&&(y+=43),!d&&w&&g&&f&&(y+=44),d&&!w&&g&&f&&(y+=45),d&&w&&g&&f&&(y+=46),y},i.prototype.ifWallTileType=function(t,i){return t>=i&&t<i+16},i.prototype.ifcanBarr=function(t,i,e,a,h,s,o,l){var r=new Array(9);r[0]=t,r[1]=i,r[2]=e,r[3]=a,r[4]=!1,r[5]=h,r[6]=s,r[7]=o,r[8]=l;for(var n=0,d=0;d<9;d++)!0===r[d]&&(n=d);var c=[];c.push(n);for(var p=0;p<c.length;){var f=c[p];p++,r[f]=!1;for(var u=f%3,w=Math.floor(f/3),g=0;g<4;g++){var y=u+this.fourX[g],v=w+this.fourY[g];y>=0&&y<3&&v>=0&&v<3&&!0===r[3*v+y]&&c.push(3*v+y)}}for(d=0;d<9;d++)if(!0===r[d])return!1;return!0},i.prototype.walkable=function(t,i){if(this.data1[i*this.width+t]!==this.Base&&this.data1[i*this.width+t]!==this.Base2&&this.data1[i*this.width+t]!==this.WalkableBase)return!1;if(this.data3[i*this.width+t]===this.Stone22)return!1;for(var e=0;e<this.Stone1.length;e++)if(this.data3[i*this.width+t]===this.Stone1[e])return!1;return!0},i.prototype.cleardeco=function(){for(var t=0;t<this.height;t++)for(var i=0;i<this.width;i++)this.data3[t*this.width+i]=0,this.data4[t*this.width+i]=0,this.data1[t*this.width+i]===this.WalkableBase&&(this.data1[t*this.width+i]=this.Base);this.data=this.data1.concat(this.data2.concat(this.data3.concat(this.data4.concat(this.data5.concat(this.data6)))))},i.prototype.adddeco=function(){for(var t=[],i=[],e=1;e<this.height-1;e++)for(var a=1;a<this.width;a++)this.ifWallTileType(this.data1[e*this.width+a],this.Wall)&&!this.ifWallTileType(this.data1[(e-1)*this.width+a],this.Wall)&&t.push(new cc.Vec2(a,e)),this.ifWallTileType(this.data1[e*this.width+a],this.Wall)&&!this.ifWallTileType(this.data1[(e+1)*this.width+a],this.Wall)&&i.push(new cc.Vec2(a,e));var h=t.length*this.ornamentsdensity;for(e=0;e<h/3;e++){var s=Math.random(),o=void 0;for(a=0;a<this.probWallTop.length;a++)s>this.probWallTop[a]&&(o=a);var l=t[Math.floor(Math.random()*t.length)];0===this.data3[l.y*this.width+l.x]&&(this.data3[l.y*this.width+l.x]=this.WallDecTop[o])}for(e=0;e<h/3;e++){for(s=Math.random(),o=void 0,a=0;a<this.probWallDown.length;a++)s>this.probWallDown[a]&&(o=a);l=i[Math.floor(Math.random()*i.length)],0===this.data3[l.y*this.width+l.x]&&(this.data3[l.y*this.width+l.x]=this.WallDecDown[o])}for(e=0;e<h/3;e++){for(s=Math.random(),o=void 0,a=0;a<this.probWall2.length;a++)s>this.probWall2[a]&&(o=a);l=t[Math.floor(Math.random()*t.length)],0===this.data3[l.y*this.width+l.x]&&0===this.data3[(l.x,l.y+1)]&&(this.data3[l.y*this.width+l.x]=this.Wall21[o],this.data3[(l.y+1)*this.width+l.x]=this.Wall22[o])}for(h=this.width*this.height*this.ornamentsdensity,e=0;e<h/4;e++){var r=1+Math.floor(Math.random()*(this.width-2)),n=1+Math.floor(Math.random()*(this.height-2));this.data1[n*this.width+r]===this.Base&&(this.data1[n*this.width+r]=this.WalkableBase)}for(e=0;e<h/4;e++)if(r=1+Math.floor(Math.random()*(this.width-2)),n=1+Math.floor(Math.random()*(this.height-2)),this.walkable(r,n)){var d=this.walkable(r-1,n-1),c=this.walkable(r,n-1),p=this.walkable(r+1,n-1),f=this.walkable(r-1,n),u=this.walkable(r+1,n),w=this.walkable(r-1,n+1),g=this.walkable(r,n+1),y=this.walkable(r+1,n+1);if(this.ifcanBarr(d,c,p,f,u,w,g,y)){s=Math.random();for(var v=0,W=0;W<this.prob1.length&&s>this.prob1[W];W++)v=W;this.data3[n*this.width+r]=this.Stone1[v]}}for(e=0;e<h/4;e++)r=1+Math.floor(Math.random()*(this.width-2)),n=1+Math.floor(Math.random()*(this.height-2)),this.walkable(r,n)&&(d=this.walkable(r-1,n-1),c=this.walkable(r,n-1),p=this.walkable(r+1,n-1),f=this.walkable(r-1,n),u=this.walkable(r+1,n),w=this.walkable(r-1,n+1),g=this.walkable(r,n+1),y=this.walkable(r+1,n+1),this.ifcanBarr(d,c,p,f,u,w,g,y)&&(this.data4[(n-1)*this.width+r]=this.Stone21,this.data3[n*this.width+r]=this.Stone22));for(e=0;e<h/4;e++)r=1+Math.floor(Math.random()*(this.width-2)),n=1+Math.floor(Math.random()*(this.height-2)),this.walkable(r,n)&&(this.data3[n*this.width+r]=this.WalkableStone);this.data=this.data1.concat(this.data2.concat(this.data3.concat(this.data4.concat(this.data5.concat(this.data6)))))},i.typeSeleceted=0,i.ornamentsdensity=.3,s([c(cc.Button)],i.prototype,"genBtn",void 0),s([c(cc.EditBox)],i.prototype,"widthText",void 0),s([c(cc.EditBox)],i.prototype,"heightText",void 0),s([c(cc.ToggleGroup)],i.prototype,"typeToggle",void 0),s([c(cc.Sprite)],i.prototype,"mapSprite",void 0),s([c(cc.Node)],i.prototype,"ornamentsNode",void 0),s([c(cc.Slider)],i.prototype,"ornamentsSlider",void 0),s([c(cc.Label)],i.prototype,"densityLabel",void 0),s([c(cc.Button)],i.prototype,"ornamentsBtn",void 0),s([c(cc.Button)],i.prototype,"clearBtn",void 0),s([c(cc.Button)],i.prototype,"saveBtn",void 0),e=s([d],i)}(cc.Component);e.default=p,cc._RF.pop()},{"./mainScript":"mainScript","./saveFile":"saveFile","./tileManager":"tileManager"}]},{},["LoadingScript","MIcaveScript","caveScript","mainScript","mapOperScript","saveFile","sketchOperScript","tileManager","typeScript","wildScript"]);